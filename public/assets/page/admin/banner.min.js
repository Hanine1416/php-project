$(document).ready(function(){var o=$(".box"),a=$("#formBanner"),u=$("#newBannerBtn"),v=$("#editBannerBtn");$(".langSwitcher").attr("disabled",!0),$("#langSwitcher option:selected").text("English");var i=0;function e(e){tinyMCE.init({max_chars:200,setup:function(e){var n=[8,37,38,39,40,46];e.on("keydown",function(e){return-1!=n.indexOf(e.keyCode)||(!(r()+1>this.settings.max_chars)||(e.preventDefault(),e.stopPropagation(),!1))}),e.on("keyup",function(e){var n,t;n=this,t=r(),$("#"+n.id).prev().find(".char_count").text(t+"/"+n.settings.max_chars)})},default_link_target:"_blank",menubar:!1,selector:e,statusbar:!0,forced_root_block:!1,ui_container:".modal",plugins:" print preview fullpage searchreplace autolink directionality  visualblocks visualchars fullscreen  link  table charmap hr pagebreak nonbreaking anchor toc insertdatetime advlist lists wordcount imagetools textpattern help",toolbar1:" bold italic underline | link ",init_instance_callback:function(e){$(".mce-tinymce").show("fast"),$(e.getContainer()).find(".mce-path").css("display","none"),$(e.getContainer()).find(".tox-statusbar__branding").css("display","none")}})}function r(){return tinymce.get(tinymce.activeEditor.id).contentDocument.body.innerText.length}function s(){var e=$("#banner-title-en"),n=$("#banner-title-fr"),t=$("#banner-title-es"),a=$("#banner-title-de"),o=$("#banner-title-anz"),i=tinyMCE.get("banner-content-en").getContent({format:"html"}),r=tinyMCE.get("banner-content-fr").getContent({format:"html"}),s=tinyMCE.get("banner-content-es").getContent({format:"html"}),c=tinyMCE.get("banner-content-de").getContent({format:"html"}),l=tinyMCE.get("banner-content-anz").getContent({format:"html"}),d=!0,b=$("#bannerModal"),f=b.find(".validate-title"),m=b.find(".validate");return f.removeClass("warning"),m.removeClass("warning"),b.find(".error").remove(),$.each(f,function(e,n){var t=$(n).val().replace(/^\s+/,"").replace(/\s+$/,"");null!==$(n).val()&&"undefined"!==$(n).val()&&""!==$(n).val()&&""!==t||!$(n).is(":visible")||$(n).hasClass("empty")||($(n).addClass("warning").parent().append('<span class="error text-center" style="position: relative;">Please complete the mandatory field</span>'),d=!1)}),$.each(m,function(e,n){var t=tinyMCE.get($(n)[0].id).getContent({format:"text"}).replace(/^\s+/,"").replace(/\s+$/,"");(tinyMCE.get($(n)[0].id).getContent({format:"html"}).length<1||""===t)&&($(n).addClass("warning").parent().append('<span class="error text-center" style="position: relative;">Please complete the mandatory field</span>'),d=!1)}),$(document).on("change keyup","input,select",function(){($(this).val()&&$(this).hasClass("warning")||"checkbox"===$(this).attr("type")&&$(this).is(":checked"))&&$(this).removeClass("warning").parent().find(".error").remove()}),d?{contentEN:i,contentFR:r,contentES:s,contentDE:c,contentANZ:l,titleEN:e.val(),titleFR:n.val(),titleES:t.val(),titleDE:a.val(),titleANZ:o.val(),bannerClose:$("#banner_close").is(":checked")?1:0,bannerActive:$("#banner_active").is(":checked")?1:0,bannerType:$("#banner-type").find("option:selected").val()}:null}function p(e,n){document.getElementById(e).value=n}$.ajax({url:"/admin/getActiveBanner",method:"get",dataType:"json",success:function(e){i=e.result}}),$(document).on("focusin",function(e){$(e.target).closest(".tox-textfield").length&&e.stopImmediatePropagation()}),e("#banner-content-en"),e("#banner-content-es"),e("#banner-content-de"),e("#banner-content-fr"),e("#banner-content-anz"),$(document).on("focusin",function(e){$(e.target).closest(".mce-window").length&&e.stopImmediatePropagation()}),$(document).on("keyup",".banner-content-es",function(){200<tinyMCE.get("banner-content-es").getContent({format:"text"}).length&&tinyMCE.get("banner-content-es").getBody().setAttribute("contenteditable",!1)}),$("#formBannerPage").on("submit",function(e){$(this).hasClass("allowSubmit")||e.preventDefault()}),$(document).on("click","#formBannerPage .btn-submit",function(){$("#formBannerPage").addClass("allowSubmit").submit()}),$(document).on("click",".preview-banner:not(.complete-url)",function(){var e=$("#current_lang").data("lang"),n=$(".show-banner");n.html(""),$(".preview-banner.selected").removeClass("selected");var t,a,o=$(this).addClass("selected").parent(),i=$(".preview-banner-modal");switch(p("banner-language",e),e){case"es":t=o[0].dataset.titleEs,a=o[0].dataset.contentEs;break;case"en":t=o[0].dataset.titleEn,a=o[0].dataset.contentEn;break;case"de":t=o[0].dataset.titleDe,a=o[0].dataset.contentDe;break;case"fr":t=o[0].dataset.titleFr,a=o[0].dataset.contentFr;break;case"anz":t=o[0].dataset.titleAnz,a=o[0].dataset.contentAnz}var r=o[0].dataset.close,e=o[0].dataset.type;n.append('<div class="row covid-banner '+e+'"><div class="covid-container"><span class="covid-tag">'+t+' </span><span class="covid-content">'+a+" </span></div></div>"),"1"===r&&$(".covid-banner").append('<div class="close" id="close-covid-banner"></div>'),i.show().addClass("active")}),$(document).on("change","#banner-language",function(){var e,n,t=$(".preview-banner.selected").parent(),a=$("#banner-language :selected").val();switch(console.log(a),a){case"es":e=t[0].dataset.titleEs,n=t[0].dataset.contentEs;break;case"en":e=t[0].dataset.titleEn,n=t[0].dataset.contentEn;break;case"de":e=t[0].dataset.titleDe,n=t[0].dataset.contentDe;break;case"fr":e=t[0].dataset.titleFr,n=t[0].dataset.contentFr;break;case"anz":e=t[0].dataset.titleAnz,n=t[0].dataset.contentAnz}$(".covid-container span.covid-tag").text(e),$(".covid-container span.covid-content").html(n)}),$(document).on("click",".btn-save-banner",function(){u.removeClass("hide");var e=$("#formBanner").data("url"),n=s(),t=$("li.banner-info").not(".disabled-banner");1==n.bannerActive&&0<t.length?(o.attr("class","box active confirm-info"),o.find(".confirm-msg").text("You should activate only one banner. Deactivate others and try again"),o.find("#box-cancel").html(DOMPurify.sanitize($("#ok-btn-box").text())),o.find("#box-cancel").css("display",""),$("#box-confirm").addClass("hidden"),$(".modal-backdrop").css("display","none"),$("#bannerModal").css("z-index","2"),o.on("click","#box-cancel",function(){o.attr("class","box"),o.off("click")})):n&&$.ajax({method:"POST",url:e,data:n,dataType:"JSON",beforeSend:function(){u.addClass("loading")},success:function(e){var n;e.success?(e.banner.type,e.banner.token,e.banner.title_e_s,e.banner.title_f_r,e.banner.title_d_e,e.banner.title_e_n,e.banner.title_a_n_z,e.banner.content_e_s,e.banner.content_f_r,e.banner.content_d_e,e.banner.content_e_n,e.banner.content_a_n_z,e.banner.is_disabled,e.banner.close_banner,e.banner.type,e.banner.title_e_n,e.banner.token,e.banner.contentEN,e.editUrl,e.deleteUrl,e.disableUrl,n=DOMPurify.sanitize(e.banner.content),$("#sortable").append(n),n=DOMPurify.sanitize(e.banner.content),e=DOMPurify.sanitize(e.banner.token),$('[name="banner['+e+']"').val(n),$(".btn-reset-form").click(),location.reload()):showErrorBox(!1,"an error occurred please repeat the process"),u.removeClass("loading")}})}),$(document).on("click",".edit-banner",function(e){e.preventDefault(),$(".edit-banner.selected").removeClass("selected"),$(this).addClass("selected");var n=$(this).parent(),t=n[0].dataset.titleEn,a=n[0].dataset.titleFr,o=n[0].dataset.titleDe,i=n[0].dataset.titleEs,r=n[0].dataset.titleAnz,s=n[0].dataset.contentEs,c=n[0].dataset.contentEn,l=n[0].dataset.contentFr,d=n[0].dataset.contentDe,b=n[0].dataset.contentAnz,f=n[0].dataset.type,m="1"===n[0].dataset.active?1:0,e="1"===n[0].dataset.close?1:0,n=$("#formBanner");n.find("#banner-title-es").val(i),n.find("#banner-title-en").val(t),n.find("#banner-title-de").val(o),n.find("#banner-title-fr").val(a),n.find("#banner-title-anz").val(r),tinymce.get("banner-content-en").setContent(c),tinymce.get("banner-content-es").setContent(s),tinymce.get("banner-content-de").setContent(d),tinymce.get("banner-content-fr").setContent(l),tinymce.get("banner-content-anz").setContent(b),n.find("#banner_active").data("active",m).prop("checked",m),n.find("#banner_close").data("close",e).prop("checked",e),p("banner-type",f),u.addClass("hide"),v.removeClass("hide");e=(n=$("#bannerModal")).find(".validate-title"),f=n.find(".validate");e.removeClass("warning"),f.removeClass("warning"),n.find(".error").remove(),$("#openModal").click()}),$(document).on("click","#editBannerBtn:not(.loading)",function(){var n=$(".edit-banner.selected"),t=n.parent(),e=n.data("url"),a=s();$("li.banner-info").not(".disabled-banner");1==a.bannerActive&&1!=t[0].dataset.active&&0<i?(o.attr("class","box active confirm-info"),o.find(".confirm-msg").text("You should activate only one banner. Deactivate others and try again"),o.find("#box-cancel").html(DOMPurify.sanitize($("#ok-btn-box").text())),o.find("#box-cancel").css("display",""),$("#box-confirm").addClass("hidden"),$(".modal-backdrop").css("display","none"),$("#bannerModal").css("z-index","2"),o.on("click","#box-cancel",function(){o.attr("class","box"),o.off("click")})):(null!=a&&v.addClass("loading"),a&&$.ajax({method:"POST",url:e,data:a,dataType:"JSON",success:function(e){e.success?(t.find(".title-banner").text(e.banner.title_e_n),t.find(".banner-content").val(e.banner.content_e_n),t[0].dataset.titleEs=e.banner.title_e_s,t[0].dataset.titleFr=e.banner.title_f_r,t[0].dataset.titleEn=e.banner.title_e_n,t[0].dataset.titleDe=e.banner.title_d_e,t[0].dataset.titleAnz=e.banner.title_a_n_z,t[0].dataset.contentEs=e.banner.content_e_s,t[0].dataset.contentFr=e.banner.content_f_r,t[0].dataset.contentEn=e.banner.content_e_n,t[0].dataset.contentDe=e.banner.content_d_e,t[0].dataset.contentAnz=e.banner.content_a_n_z,t[0].dataset.type=e.banner.type,t[0].dataset.close=e.banner.close_banner,t[0].dataset.active=e.banner.is_disabled,$(".btn-reset-form").click(),location.reload()):(showErrorBox(!1,"an error occurred please repeat the process"),$(".btn-reset-form").click(),v.removeClass("loading")),v.removeClass("loading"),n.removeClass("selected")},fail:function(){showErrorBox(!1,a.message),$(".btn-reset-form").click(),v.removeClass("loading")}}),v.removeClass("loading"))}),$(document).on("click",".disable-banner:not(.loading)",function(e){e.preventDefault();var n=$(this),t=n.data("url");o.attr("class","box active confirm-info"),o.find(".confirm-msg").text($("#deactivate-banner").text()),o.find("#box-cancel").css("display",""),o.on("click","#box-confirm",function(){$(this).prev().hide(),$.ajax({url:t,method:"post",dataType:"json",beforeSend:function(){n.addClass("loading")},success:function(e){e.success?n.closest("li").addClass("disabled-banner"):showErrorBox(!1,"an error occurred please repeat the process"),n.removeClass("loading"),location.reload()}}),o.removeClass("active")}),o.on("click","#box-cancel",function(){o.attr("class","box"),o.off("click")})}),$(document).on("click",".enable-banner:not(.loading)",function(e){e.preventDefault();var n=$(this),t=n.data("url"),a=$("li.banner-info").not(".disabled-banner").length;0==a&&$.ajax({url:"/admin/getActiveBanner",method:"get",dataType:"json",success:function(e){1==e.result&&(o.attr("class","box active confirm-info"),o.find(".confirm-msg").text("You should activate only one banner. Deactivate others and try again"),o.find("#box-cancel").html(DOMPurify.sanitize($("#ok-btn-box").text())),o.find("#box-cancel").css("display",""),$("#box-confirm").addClass("hidden")),a=e.result}}),0<a?(o.attr("class","box active confirm-info"),o.find(".confirm-msg").text("You should activate only one banner. Deactivate others and try again"),o.find("#box-cancel").html(DOMPurify.sanitize($("#ok-btn-box").text())),o.find("#box-cancel").css("display",""),$("#box-confirm").addClass("hidden")):(o.attr("class","box active confirm-info"),o.find(".confirm-msg").text($("#activate-banner").text()),o.find("#box-cancel").css("display",""),o.on("click","#box-confirm",function(){$(this).prev().hide(),$.ajax({url:t,method:"post",dataType:"json",beforeSend:function(){n.addClass("loading")},success:function(e){e.success?n.closest("li").removeClass("disabled-banner"):showErrorBox(!1,"an error occurred please repeat the process"),n.removeClass("loading"),location.reload()}}),o.removeClass("active")})),o.on("click","#box-cancel",function(){o.attr("class","box"),o.off("click"),$("#box-confirm").removeClass("hidden"),o.find("#box-cancel").html(DOMPurify.sanitize($("#cancel-btn-box").text())),location.reload()})}),$(document).on("click",".delete-banner:not(.loading)",function(e){e.preventDefault();var n=$(this),t=n.data("url");o.attr("class","box active confirm-info"),o.find(".confirm-msg").text("Are you sure you want to delete tha banner for all languages."),o.find("#box-cancel").css("display",""),o.on("click","#box-confirm",function(){$(this).prev().hide(),$.ajax({url:t,method:"post",dataType:"json",beforeSend:function(){n.addClass("loading")},success:function(e){e.success?n.closest("li").remove():showErrorBox(!1,"an error occurred please repeat the process"),n.removeClass("loading")}}),o.removeClass("active")}),o.on("click","#box-cancel",function(){o.attr("class","box"),o.off("click")})}),$(".btn-reset-form").on("click",function(){$(".editRow").removeClass("editRow"),u.removeClass("hide"),v.addClass("hide"),$(".error:not(.hide)").addClass("hide"),a.find("#banner-title-en").val(""),a.find("#banner-title-es").val(""),a.find("#banner-title-fr").val(""),a.find("#banner-title-de").val(""),a.find("#banner-title-anz").val(""),tinymce.get("banner-content-en").setContent(""),tinymce.get("banner-content-es").setContent(""),tinymce.get("banner-content-de").setContent(""),tinymce.get("banner-content-fr").setContent(""),tinymce.get("banner-content-anz").setContent(""),a.find("#banner_close").data("close",!1).prop("checked",!1),a.find("#banner_active").data("active",!1).prop("checked",!1);var e=$("#bannerModal"),n=e.find(".validate-title"),t=e.find(".validate");n.removeClass("warning"),t.removeClass("warning"),e.find(".error").remove(),location.reload()})});