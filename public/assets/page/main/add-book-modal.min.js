$(document).ready(function(){$("#page-title").val();var a={},t=$(".box");function i(){$(".new_reading_list_modal .modal-step").removeClass("active"),$("#formAddReadingList #step1").addClass("active"),$("#formAddReadingList #readingListName").val(""),$("#formAddReadingList #courseName").val(""),$("#formAddReadingList #courseType").val(""),$("#formAddReadingList #courseLevel").val("").trigger("change"),$("#formAddReadingList #studentsNumber").val(""),$("#formAddReadingList #startDate").datepicker("setDate",null),$("#formAddReadingList #institutions-selector option.my-primary").prop("selected",!0).trigger("change"),$(".modal-step .error").remove(),$(".modal-step .warning").removeClass("warning")}function s(){let e=$("#step1-add-book"),a=$("#step2-add-book");$("#checkOneReadingListMsg").hide(),a.removeClass("active"),e.addClass("active"),$(".multi_institutions").prop("checked",!1)}t.find("#box-confirm").text($("#box-msg-yes").text()),t.find("#box-cancel").text($("#box-msg-no").text()),$(document).on("click","#btn-add-reading-list",function(){i(),$(".new_reading_list_modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")}),$(".new_reading_list_modal .close").show()}),$(document).on("click",".new_reading_list_modal #close-modal",function(e){e.preventDefault();var a=$(".new_reading_list_modal");"step3"===a.find(".modal-step.active").attr("id")?(closeModal(a),i()):(t.attr("class","box active confirm-info"),t.find(".confirm-msg").text($("#cancel-list-msg").text()),$("body").addClass("box-above-modal"),t.on("click","#box-cancel",function(){t.removeClass("active confirm-info"),t.off("click"),$("body").removeClass("box-above-modal")}).on("click","#box-confirm",function(){t.removeClass("active confirm-info"),closeModal(a),t.off("click"),$("body").removeClass("box-above-modal"),i()}))}),$(document).on("click",".new_reading_list_modal .goStep:not(.loading)",function(e){e.preventDefault();e=$(this).data("target-step");a.readingListName=$("#formAddReadingList #readingListName").val(),$("#formAddReadingList #readingListName .error").remove(),0<a.readingListName.length?(a.readingListName=$("#formAddReadingList #readingListName").val(),function(a,t){var i=$("#submit-request-btn");i.addClass("loading"),$.ajax({url:$("#formAddReadingList").data("url"),method:"POST",data:a,success:function(e){i.removeClass("loading"),t(e.success,a,e)},error:function(e){i.removeClass("loading"),401===e.status&&document.location.reload()}})}(a,function(e,a,t){var i,s,d;e&&(0==$(".reading-list-item").find(".multi_institutions").length&&($("#reading-lists-check-container .empty-modal").remove(),$("#reading-lists-check-container").attr("id",""),$("#formAddBook #add-book-reading-list").removeClass("disabled-btn").attr("disabled",!1)),i=' <div class="input-field user-term small-12 medium-12 large-12 columns checkbox__item reading-list-item "><input   class="checkbox__input multi_institutions"type="checkbox"name="" id="'+t.id+'"value="'+t.id+'"><label class="checlbox__label"for="'+t.id+'">'+a.readingListName+"</label></div>",s=DOMPurify.sanitize(i),$('div[title="reading-lists-check"]').append(s),e=$(".tabs-nav ul"),i=$("#reading-list-content"),$("#formAddReadingList #step2").removeClass("active"),$("#formAddReadingList #step3").addClass("active"),e.find("li").removeClass("active"),s='<li class="active">                                <a href="#'+t.id+'" data-toggle="tab" data-id='+t.id+'>                                    <div class="book-info">                                        <div class="book-name"> '+a.readingListName+'</div>                                        <div class="nbr-books" data-id="">0 '+$("#books-tab").text()+"</div>                                    </div>                                </a>                            </li>",s=DOMPurify.sanitize(s),e.append(s),i.find(".tab-pane").removeClass("active"),a='<div class="tab-pane active" id="'+t.id+'" \n<div id="tab1" class="tabs_container">\n        <div class="reading-info nexusSans">\n        <div class="reading-info-container row">\n            <div class="reading_info_contents small-12 medium-9 large-9 columns">\n                <div class="reading-list-name"> '+a.readingListName+' <span>\n                         <a href="javascript:;" class="edit-reading-list-btn">\n                                        <img src="http://InspectionCopy.test/assets/img/icon-edit/icon_edit.jpg?v=2.5.3" srcset="http://InspectionCopy.test/assets/img/icon-edit/icon_edit@2x.jpg?v=2.5.3 2x,http://InspectionCopy.test/assets/img/icon-edit/icon_edit@3x.jpg?v=2.5.3 3x" class="icon_edit" data-toggle="tooltip" data-placement="bottom" title="" data-original-title="Edit"></a>\n                    </span>\n                </div>\n            </div>\n<div class="sharing sharing_header">\n                                <div class="container">\n                                    <div class="more">\n                                        <button id="more-btn" class="more-btn" data-toggle="tooltip" data-placement="bottom"\n                                                title="{{ \'tooltip.more\'|trans }}">\n                                            <span class="more-dot"></span>\n                                            <span class="more-dot"></span>\n                                            <span class="more-dot"></span>\n                                        </button>\n                                        <div class="more-menu">\n                                            <ul class="more-menu-items" tabindex="-1" role="menu"\n                                                aria-labelledby="more-btn" aria-hidden="true">\n                                                <li class="more-menu-item"\n                                                    role="">\n                                                    <div class="read-now-btn" id="remove-list-btn"\n                                                         data-reading-list-id="'+a.readingListID+'">\n                                                        <a href="javascript:;"\n                                                           class="more-menu-btn"\n                                                           role="menuitem">Delete list</a>\n                                                    </div>\n                                                </li>\n                                            </ul>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                    </div>\n       </div>\n   <div class="list_reading_books">\n   </div>\n </div>\n</div>',a=DOMPurify.sanitize(a),i.append(a),d=$("#drag-books").text(),["","core","supplementary","recommended"].forEach(e=>{var a='<div class="book_type '+e+'">'+$("#category-"+e).text()+'</div>\n                    <div class="books_list '+e+'">\n                        <div class="drop-zone empty-zone" id="'+e+'">\n                                <div class="drag-placeholder nexusSans"\n                                     id="placeholder_drag">'+d+"</div>\n                        </div>\n                    </div>",e=DOMPurify.sanitize(t.id),a=DOMPurify.sanitize(a);$("#reading-list-content #"+e+" .list_reading_books").append(a)}))}),$(this).closest(".modal-step").removeClass("active"),$("#formAddReadingList #"+e).addClass("active")):($("#formAddReadingList #readingListName").addClass("warning"),e=DOMPurify.sanitize('<span class="error">'+$("#formAddReadingList #readingListName").prop("title")+"</span>"),$("#error_msg").html(e))}),$(document).on("click","#add-book-btn",function(){s();var e=$(this).data("isbn"),a=$(this).data("title");localStorage.removeItem("selectedIsbn"),localStorage.removeItem("title"),localStorage.setItem("selectedIsbn",e),localStorage.setItem("title",a),$("#action-book-modal-content").html(""),$.ajax({url:"/get-allowed-reading-list",method:"get",data:{isbn:e},dataType:"html",success:function(e){$("#add-book-modal").show().addClass("active"),$("#action-book-modal-content").html(DOMPurify.sanitize(e)),$("#action-book-modal").show().addClass("active"),$("#step1-add-book").addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable"),window.innerWidth<640&&$(".modal-step-content").css("minHeight",$("#copy-book-modal").height()-86)}),$("#add-book-modal .close").show()}})}),$(document).on("click",".close,#browse_btn_add_book",function(){localStorage.removeItem("readingListId"),s(),$("#add-book-modal").hide().removeClass("active"),modalFix(function(){$("body,html").removeClass("modal-open active-request scrollable")}),$("#add-book-modal .close").hide()}),$(document).on("click","#add-book-reading-list",function(e){e.preventDefault();var a,t=$(".reading-lists input:checked"),e=$("#formAddBook").data("url"),i={readingLists:[]};localStorage.removeItem("readingListId"),0==t.length?$("#checkOneReadingListMsg").show():($("#checkOneReadingListMsg").hide(),$.each(t,function(e,a){i.readingLists.push({id:$(a).attr("id")})}),i.isbn=localStorage.getItem("selectedIsbn"),i.bookTitle=localStorage.getItem("title"),a=$("div").find('.recommended-books-list[id="'+i.isbn+'"]'),$.ajax({url:e,method:"POST",data:i,beforeSend:function(){$(this).addClass("loading")},success:function(e){e.success&&($("#step1-add-book").removeClass("active"),$("#step2-add-book").addClass("active"),localStorage.setItem("readingListId",i.readingLists[0].id),localStorage.setItem("addedListSelected",!0),$(this).removeClass("loading"),a.remove())}}))})});