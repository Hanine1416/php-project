function submitInstitutionFromModal(n,t,i){var e=!0,a=n.find(".institution-name:visible,.institution-id:visible,.department-name:visible,.department-id:visible,.profession:visible,.speciality:visible"),o=$("#institutions-selector"),s=n.find(".zip-filter");a.removeClass("warning"),n.find(".error").remove(),0<s.length&&s.hasClass("warning")&&s.parent().append('<span class="error">'+s.data("wrong")+"</span>"),0<s.length&&!1===n.find(".zip-filter-block").hasClass("hidden")&&a.push(n.find(".zip-filter ").first()),0<n.find(".state-filter ").length&&!1===n.find(".state-filter-block").hasClass("hidden")&&a.push(n.find(".state-filter ").first()),$.each(a,function(t,n){var i;$(n).val()||($(n).parent().find(".error").remove(),i=DOMPurify.sanitize($(n).prop("title")),$(n).addClass("warning").parent().append('<span class="error">'+i+"</span>"),e=!1)}),0<s.length&&s.parent().children().hasClass("error")&&(e=!1);var l=$("#institution_id"),d=$("#institution_institutionId"),r=$("#institution_institutionName"),c=$("#institution_departmentId"),u=$("#institution_departmentName"),p=$("#institution_profession"),f=$("#institution_speciality"),a=$("#institution_isPrimary"),s=$("#complete_register_country"),l=[{name:"institution_institution_id",value:d.val()?d.val():""},{name:"institution_institution_name",value:r.val()},{name:"institution_department_id",value:c.val()?c.val():""},{name:"institution_department_name",value:u.val()},{name:"institution_profession",value:p.val()},{name:"institution_speciality",value:f.val()},{name:"institution_primary",value:a.is(":checked")?1:0},{name:"institution_id",value:l.val()?l.val():""}];if(0<$("#nb-institution").length&&0==$("#nb-institution").data("nb-institution")&&""!=s.val()&&l.push({name:"country",value:s.val()}),n.find(".institution-name").is(":visible")&&(l[0].value=""),n.find(".department-name").is(":visible")&&(l[2].value=""),e)if(!1===$("#step1").data("first-request")||0<$(".my-institution-page").length)$.ajax({url:n.attr("action"),method:t?"POST":"PUT",dataType:"JSON",data:l,beforeSend:function(){n.addClass("loading")},success:function(t){o.data("inst")&&(o.data().inst+=1),i(t)},error:function(t){n.removeClass("loading"),401===t.status?showErrorBox($("#loggedOutMsg").text()):showErrorBox($("#error").text())}});else{l=uniqueID();let t={success:!0,institution:{id:d.val()?d.val():"",institution_name:r.val(),department_id:c.val()?c.val():"",department_name:u.val(),profession:p.val(),speciality:f.val(),primary:a.is(":checked")?1:0,institution_id:l}};0===o.data("first")&&(t.institution.country=s.val()),o.data().inst+=1,o.attr("data-first",1),n.removeClass("loading"),closeInstitutionModal(),i(t)}}function initAllSelectorWithSelect2(e,t){var a=e.find(".institution-id"),n=e.find(".department-id"),i=e.find(".profession"),o=e.find(".speciality"),s=e.find(".city-filter"),l=e.find(".state-filter"),d=e.find(".zip-filter"),r=$("#current_country").data("country").toLowerCase(),c="";if($.each(institutionsData,function(t,n){var i=new Option;i.text=DOMPurify.sanitize(n.text),i.value=n.value,i.setAttribute("data-type",n.getAttribute("data-type")),a.append(i)}),0<l.length&&("united states"==r||"us"==r)&&(c="Select your institution"),!$("#institutions-selector").data("first")){let t=$(".country-block").find("#complete_register_country");t.select2({placeholder:"",dropdownParent:t.parent()}).on("change",function(){$(this).val()&&(1===$("#current_region").data("region")&&"australia"===$("#current_country").data("country")||9===$("#current_region").data("region")&&("united states"==r||"us"==r)?loadStates($(this).val(),l):loadInstitutions($(this).val(),"","","",e),"in"===e.data("lang")&&loadCities($(this).val(),s))})}a.select2({placeholder:c,dropdownParent:a.parent()}).on("change",function(t){var n=e.find(".institution-name"),i=$(this).find("option:selected");n.val(i.text()),$(this).val()&&("de"===e.data("lang")&&"university"!==i.data("type").toLowerCase()?e.find(".department-text-block,.department-selector-block").addClass("f-hidden"):(e.find(".department-text-block,.department-selector-block").removeClass("f-hidden"),loadDepartments($(this).val(),$(this).closest(".institution-block"))))}),n.select2({placeholder:"",dropdownParent:n.parent()}).on("select2:opening",function(t){1===n.data("loaded")||n.hasClass("s2-loading-data")||loadDepartments(a.val(),e,!0),n.hasClass("s2-loading-data")&&t.preventDefault()}).on("change",function(){e.find(".department-name").val($(this).find("option:selected").text())}),o.select2({placeholder:"",dropdownParent:o.parent()}).on("select2:opening",function(t){1!==o.data("loaded")&&!o.hasClass("s2-loading-data")&&$(this).val()&&loadSpecialities(i.data("value"),o.closest(".institution-block"),!0),o.hasClass("s2-loading-data")&&t.preventDefault()}),i.select2({placeholder:"",dropdownParent:i.parent()}).on("change",function(){$(this).val()&&(loadSpecialities($(this).val(),e),"in"===e.data("lang")&&a.val()&&loadDepartments(a.val(),e))}),0<s.length&&(s.select2({placeholder:"",dropdownParent:s.parent()}).on("change",function(){!0===$("#step1").data("first-request")?loadInstitutions($("#complete_register_country").val(),$(this).val(),"","",e):loadInstitutions($(this).data("country"),$(this).val(),"","",e)}),t?(s.data("country",t),d.data("country",t),loadCities(t,s)):s.data("country")&&loadCities(s.data("country"),s)),t&&d.data("country",t),0<d.length&&$(d).on("change",function(t){var n=$(this).data("country");""==n&&(n=$("#complete_register_country").val()),loadInstitutions(n,"",$(this).val(),"",e)}),0<l.length&&(l.select2({placeholder:"",dropdownParent:l.parent()}).on("change",function(){loadInstitutions($(this).data("country"),"","",$(this).val(),e)}),t?(l.data("country",t),loadStates(t,l)):l.data("country")&&loadStates(l.data("country"),l))}function resetInstitutionModalInput(t){$.each(t.find('input[type="text"],select'),function(t,n){$(n).val("").trigger("change.select2").trigger("change")}),$(t).find("select").data("loaded",0).data("value",""),$(t).find("input").data("value",""),$(".institution-modal .institution-id").select2("data",institutionsData);var n=$(".btn-cancel-new-institution"),t=$(".btn-cancel-new-department");1<$(".institution-id option").length&&(n.click().hide(),t.click().show()),0!=$("#institutions-selector").attr("data-first")&&($("#institution_isPrimary").prop("checked",!1),$("#institution_isPrimary").attr("disabled",!1))}function closeInstitutionModal(){$(".institution-modal .error").remove(),$(".institution-modal .warning").removeClass("warning"),0===$(".request-book-modal.active").length&&modalFix(function(){$("body,html").removeClass("modal-open scrollable")}),$(".institution-modal.active").fadeOut(200,function(){$(".institution-modal").removeClass("active")}),$(".institution-modal").removeClass("edit-mode").find("[data-value]").data("value",""),$(".institution-modal .fieldset").removeClass("readOnly"),$("#updateInstitution").attr("disabled",!0).removeClass("hidden"),$("#disableInstitution").addClass("hidden"),$("#deleteInstitution").removeClass("hidden"),$("#primary-block").show(),resetInstitutionModalInput($(".institution-modal form"))}$(document).ready(function(){$("#complete_register_country").on("change",function(){0<["deutschland","Ã¶sterreich","schweiz"].includes($(this).val().toLowerCase())?$(".zip-filter-block").removeClass("hidden"):$(".zip-filter-block").addClass("hidden")}),initAllSelectorWithSelect2($(".institution-block")),$(document).on("click",".btn-new-institution",function(){var t=$(this).closest(".institution-block");t.find(".institution-selector-block").hide(),t.find(".institution-text-block").show().find("input").val(""),t.find(".btn-cancel-new-department").hide(),t.find(".btn-new-department").click(),$(".department-text-block,.department-selector-block").removeClass("f-hidden"),t.find(".btn-cancel-new-institution").parent().show(),t.find(".btn-cancel-new-institution").parent().removeClass("hidden"),t.find(".btn-cancel-new-institution").show()}),$(document).on("click",".btn-cancel-new-institution",function(){var t=$(this).closest(".institution-block");t.find(".institution-selector-block").show().find("select").val("").trigger("change"),t.find(".institution-text-block").hide(),t.find(".btn-cancel-new-department").click(),t.find(".btn-new-department").show(),t.find(".btn-cancel-new-department").show(),t.find(".btn-cancel-new-department").parent().show()}),$(document).on("click",".btn-new-department",function(){var t=$(this).closest(".institution-block");t.find(".department-selector-block").hide(),t.find(".department-text-block").show().find("input").val("")}),$(document).on("click",".btn-cancel-new-department",function(){var t=$(this).closest(".institution-block");t.find(".department-selector-block").show().find("select").val("").trigger("change"),t.find(".department-text-block").hide()})});