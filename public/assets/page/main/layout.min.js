var institutionsData=[],cities=null,searchPlaceholder=$("#search-placeholder").text(),clickCount=0,click=0,source="";$.fn.select2.defaults.set("searchInputPlaceholder",searchPlaceholder);var currentLang="en",current_region="7",currentCountry=$("#current_country").data("country").toLowerCase(),introText=$("#virtual-tour-intro").text(),step1Text=$("#virtual-tour-step1").text(),step2Text=$("#virtual-tour-step2").text(),step3Text=$("#virtual-tour-step3").text(),step4Text=$("#virtual-tour-step4").text(),step5Text=$("#virtual-tour-step5").text(),nextBtnText=$("#virtual-tour-next").text(),skipBtnText=$("#virtual-tour-skip").text(),doneBtnText=$("#virtual-tour-done").text(),backBtnText=$("#virtual-tour-back").text(),homePageGuide=introJs(),homePageGuideUSANZ=introJs(),catalogSwitcher=$(window).width()<=1025?".mobile-catalog-switcher .catalog-links ul":".desktop-catalog-switcher .catalog-links";homePageGuide.setOptions({nextLabel:nextBtnText+" →",skipLabel:skipBtnText,prevLabel:"← "+backBtnText,doneLabel:doneBtnText,exitOnOverlayClick:!1,steps:[{element:".discover-block",intro:introText,position:"auto"},{element:".dropdown-notif",intro:step1Text,position:"auto"},{element:".profile",intro:step2Text,position:"auto"},{element:catalogSwitcher,intro:step3Text,position:"auto"},{element:"#language-switcher",intro:step4Text,position:"auto"},{element:"#click-here",intro:step5Text,position:"auto",highlightClass:"#e6782b"}]}),homePageGuideUSANZ.setOptions({nextLabel:nextBtnText+" →",skipLabel:skipBtnText,prevLabel:"← "+backBtnText,doneLabel:doneBtnText,exitOnOverlayClick:!1,steps:[{element:".discover-block",intro:introText,position:"bottom"},{element:".dropdown-notif",intro:step1Text,position:"bottom"},{element:".profile",intro:step2Text,position:"bottom"},{element:"#click-here",intro:step5Text,position:"bottom",backgroundColor_:"#ffff"}]});var catalogueLang=DOMPurify.sanitize(Cookies.get("site-lang")),userPhase=$(".discover-block").data("user-phase"),langCataSwitcher=$(".switcher-container"),updateDone=!1;function updateGuide(e){$.ajax({url:$(".discover-block").data("update-guide-url"),method:"POST",data:{phase:e},success:function(e){e.success&&(updateDone=!0)}})}function sanitizeHTML(e){if("string"!=typeof e)return e;var t=new RegExp(`<(${["p","a","b","i","em","strong","br","input","span","li","ul","div","img"].join("|")})[^>]*>`,"gi"),a=new RegExp(`(\\s(${["href"].join("|")})="[^"]*")`,"gi");return e=(e=e.replace(t,"")).replace(a,"")}function growl(e,t){}function ValidURL(e){var t=new RegExp("^(?!mailto:)(?:(?:http|https|ftp)://)(?:\\S+(?::\\S*)?@)?(?:(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[0-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))|localhost)(?::\\d{2,5})?(?:(/|\\?|#)[^\\s]*)?$","i");return e.length<2083&&t.test(e)}function urlParam(e){e=new RegExp("[?&]"+e+"=([^&#]*)").exec(window.location.href);return e?e[1]:null}function validatePhoneNumber(e,t){e.removeClass("warning").next(".error").remove();var a=e.val();try{const i=libphonenumber.parsePhoneNumberFromString(a,t);var o,n=i&&i.isValid();return console.log(i),n&&i.country===t?e.removeClass("warning"):(o=DOMPurify.sanitize(e.data("wrong")),e.addClass("warning").parent().append('<span class="error">'+o+"</span>")),n}catch(e){return console.error("Error validating phone number:",e),!1}}function reCaptchaVerify(e){e===document.querySelector(".g-recaptcha-response").value&&(doSubmit=!0)}function reCaptchaCallback(){}function isMailValid(e,t){e=sanitizeHTML(e),t=sanitizeHTML(t);var a=DOMPurify.sanitize($("#error_1103").text()),o=DOMPurify.sanitize($("#error_1074").text()),n=t.find(".error"),i=new RegExp(/^[+a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/i);if(e.length<1){if(!n.length||"#continue_registration"===t.selector)return"#continue_registration"===t.selector?(t.append('<span class="error"  style="position: relative;">'+a+"</span>"),t.css("padding","8px 16px"),$("#request_register_email").addClass("warning")):(t.append('<span class="error">'+a+"</span>"),t.find("input").addClass("warning")),!1;n.text($("#error_1103").text())}else if(!i.test(e)&&0<e.length){if(!n.length||"#continue_registration"===t.selector)return"#continue_registration"===t.selector?(t.append('<span class="error"  style="position: relative;">'+o+"</span>"),t.css("padding","8px 16px"),$("#request_register_email").addClass("warning")):(t.append('<span class="error">'+o+"</span>"),t.find("input").addClass("warning")),!1;n.text($("#error_1074").text())}else t.find("input").removeClass("warning"),"#continue_registration"!==t.selector&&t.find(".error").remove();return!0}function closeModal(e){e.find(".error").remove(),e.find(".warning").removeClass("warning"),e.fadeOut(200,function(){e.removeClass("active")}),modalFix(function(){$("body,html").removeClass("modal-open scrollable")})}function showLoginBox(){$(".login-modal #login-content").removeClass("hidden"),$(".login-modal #forget-content").addClass("hidden"),$(".login-modal #register-content").addClass("hidden"),$(".login-modal .success-email").addClass("hidden"),$(".login-modal").addClass("active").fadeIn(200,function(){modalFix(function(){$("body,html").addClass("modal-open")})})}function checkFieldEmpty(e){null!==e.val()&&"undefined"!==e.val()&&""!==e.val()&&(e.hasClass("warning")&&e.removeClass("warning"),e.parent().find(".error").remove())}function login(t){var o=!0,e=t.closest("form"),a=e.prop("action"),n=e.find(".username"),i=e.find(".password"),s=e.find("#_remember_me"),r=$(".login-modal");$.each([n,i],function(e,t){var a;t.removeClass("warning"),t.parent().find(".error").remove(),0===t.val().length&&(a=DOMPurify.sanitize($(t).prop("title")),$(t).addClass("warning").parent().append('<span class="error">'+a+"</span>"),o=!1)});e=isMailValid(n.val(),n.parent());(o=o&&e)&&($.ajax({url:baseUrl+"/clear-books-session",success:function(e){}}),e={username:n.val(),password:i.val()},s.prop("checked")?e.remember="on":e.remember=null,$.ajax({url:a,method:"POST",data:e,dataType:"JSON",beforeSend:function(){r.addClass("readOnly"),t.addClass("loading")},success:function(e){e.success?window.location.pathname.includes("/book/details")?location.reload():window.location=DOMPurify.sanitize(e.redirect):("undefined"!==e.reply&&"1105"===e.reply?showErrorBox(DOMPurify.sanitize($("#error_1105").text())).find("#box-ok").text($("#box-msg-close").text()):3===clickCount?(clickCount=0,showInfoBox(DOMPurify.sanitize($("#prompet-forget-pwd-msg").html())).find("#box-ok").text($("#close-msg-reset-password").text())):showErrorBox(DOMPurify.sanitize($("#error_1121").text())),t.removeClass("loading"),r.removeClass("readOnly"))},fail:function(){showErrorBox(DOMPurify.sanitize($("#error_1121").text())),t.removeClass("loading"),r.removeClass("readOnly")}})),n.on("keyup",function(){isMailValid(n.val(),n.parent())}),i.on("keyup",function(){var e=DOMPurify.sanitize($(this).prop("title"));$(this).val()?$(this).removeClass("warning").parent().find(".error").remove():$(this).addClass("warning").parent().append('<span class="error">'+e+"</span>")})}function loadCities(e,o){0<o.length&&$.ajax({url:baseUrl+"/cities/"+e,beforeSend:function(){o.addClass("s2-loading-data"),o.html("")},success:function(e){o.append("<option></option>"),cities=[],e.status&&(cities.push({id:"",text:""}),$.each(e.results,function(e,t){var a=new Option;a.text=t,a.value=t,o.append(a),cities.push({id:t,text:t})})),o.removeClass("s2-loading-data")}})}function loadStates(e,o){0<o.length&&$.ajax({url:baseUrl+"/states/"+e,beforeSend:function(){o.addClass("s2-loading-data"),o.html("")},success:function(e){o.append("<option></option>"),states=[],e.status&&(states.push({id:"",text:""}),$.each(e.results,function(e,t){var a=new Option;a.text=t,a.value=t,o.append(a),states.push({id:t,text:t})})),o.removeClass("s2-loading-data")}})}function loadInstitutions(e,n,i,t,s,r){var l=s.find(".institution-id"),c=s.find(".institution-name"),d=s.find(".department-id"),u=s.find(".department-name");""!=i&&$("#zip_filter_modal").addClass("loading-data"),"us"==e.toLowerCase()&&(e="United States"),l.addClass("s2-loading-data"),c.addClass("loading-data"),s.find(".department-text-block,.department-selector-block").removeClass("f-hidden"),s.find(".department-text-block,.department-selector-block").removeClass("hidden"),$.post(baseUrl+"/institutions",{country:e,city:n,zipCode:i.replace(/\s/g,""),state:t},function(e){if(l.html("<option value=''></option>"),d.html("<option value=''></option>"),e.status){for(var t in l.parent().show(),l.parent().removeClass("hidden"),c.parent().hide(),d.parent().hasClass("is-br")||(d.parent().show(),u.parent().hide()),""===n&&""===i&&(institutionsData=[new Option]),e.results){var a=new Option;a.text=e.results[t].name,a.value=t,a.setAttribute("data-type",e.results[t].type),""===n&&""===i&&institutionsData.push(a),l.append(a)}200<Object.keys(e.results).length&&isIE()&&l.select2({minimumInputLength:2}),l.parent().find(".warning").removeClass("warning"),l.parent().find(".error").remove(),s.find(".btn-cancel-new-institution").show(),$(".select2-selection__placeholder").remove()}else{var o;0<i.length&&((o=$(s).find(".zip-filter")).addClass("warning"),o.parent().append('<span class="error">'+o.data("wrong")+"</span>")),l.parent().hide(),c.val("").parent().show(),u.val("").parent().show(),d.parent().hide(),s.find(".btn-cancel-new-institution").hide(),s.find(".btn-cancel-new-department").hide(),s.find(".btn-new-department").hide()}""!=i&&$("#zip_filter_modal").removeClass("loading-data"),d.parent().removeClass("hidden"),l.removeClass("s2-loading-data"),c.removeClass("loading-data"),s.removeClass("loading"),r&&r()})}function loadDepartments(e,o,n){var i=o.find(".department-id"),s=o.find(".department-name");i.addClass("s2-loading-data"),s.addClass("loading-data");var r="in"===o.data("lang")?o.find(".profession").val():"";$("#institution_departmentName").val(""),$.post(baseUrl+"/departments",{institution:e,profession:r},function(e){if(i.html(""),i.data("loaded",1),e.status){for(var t in i.append("<option></option>"),e.results){var a=new Option;a.text=e.results[t],a.value=t,a.selected=i.data("value")===t,i.append(a)}i.parent().show(),s.parent().hide(),o.find(".btn-new-department").show(),"in"===o.data("lang")&&(r.toLowerCase().includes("veterinary")?o.find(".btn-new-department").removeClass("f-hidden"):(o.find(".btn-new-department").addClass("f-hidden"),o.find(".btn-cancel-new-department").click()))}else o.find(".department-text-block").show(),o.find(".department-selector-block").hide(),o.find(".btn-cancel-new-department").hide();i.removeClass("s2-loading-data"),s.removeClass("loading-data"),n&&i.select2("open")})}function loadSpecialities(e,t,n){var i=t.find(".speciality");i.addClass("s2-loading-data"),i.removeClass("empty"),i.removeClass("warning").parent().find(".error").remove(),$.post(baseUrl+"/specialities",{profession:e},function(e){if(i.html(""),i.data("loaded",1),e.status){i.parent().is(":visible")||i.parent().show(),i.append("<option></option>");var t,a=i.data("value");for(t in e.results){var o=new Option;o.value=e.results[t],o.text=e.results[t],o.selected=a===e.results[t],i.append(o)}}else i.addClass("empty");i.removeClass("s2-loading-data"),n&&i.select2("open")})}function cancelUpdateBlock(e){$.each(e.find("[data-value]"),function(e,t){$(t).data("value")!==$(t).val()&&(($(t).is('input[type="checkbox"]')?$(t).prop("checked",$(t).data("value")):$(t).val($(t).data("value"))).trigger("change"),$(t).is("select")&&$(t).trigger("change"))});var t=$(".new-institution-block");0<t.length&&t.parent().remove(),e.find(".update-btn").attr("disabled",!0)}function showSaveUpdateBox(e,t){var a=$(".box");a.attr("class","box active confirm-info "),$("body,html").addClass("modal-open scrollable"),a.on("click","#box-confirm",function(){cancelUpdateBlock(e),t(),a.removeClass("active confirm-info "),$("body,html").removeClass("modal-open scrollable"),a.off("click")}),a.on("click","#box-cancel",function(){a.removeClass("active confirm-info "),$("body,html").removeClass("modal-open scrollable"),a.off("click")})}function showErrorBox(e){var t=$(".box"),a=t.find(".error-msg");return a.html(e),t.attr("class","box active error-info"),t.find("#box-ok").text($("#ok-btn-box").text()),t.on("click","#box-ok",function(){t.removeClass("active error-info"),a.text(""),t.off("click")}),t}function showInfoBox(e){var t=$(".box"),a=t.find(".info-msg");return a.html(e),t.attr("class","box active warning-info"),t.find("#box-ok").text($("#ok-btn-box").text()),t.on("click","#box-ok",function(){t.removeClass("active warning-info"),a.text(""),t.off("click")}),t}function isMobile(){return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,4))}function checkReCaptcha(e){return 0!==grecaptcha.getResponse(e).length}function copyToClipboard(e,t="body"){var a=$("<input>"),t=$(t);t.append(a),a.val(e).select(),document.execCommand("copy"),a.remove();a=DOMPurify.sanitize($("#clipboard-copy").text());t.append('<div class="clipboard-toaster"><p class="clipboard-toaster-text">'+a+"</p></div>"),$(".clipboard-toaster").fadeOut(4e3,function(){$(".clipboard-toaster").remove()})}function modalFix(e){var t=$("body"),a=$("html"),o=window.scrollY||(t.scrollTop()?t:a).scrollTop();e(),t.scrollTop(o),a.scrollTop(o)}function fixLoginModalIpad(){navigator.userAgent.match(/iPad/i)&&640<$(window).width()&&$(".modal-dialog").addClass("top-modal-ipad")}function isIE(){return navigator.userAgent.match(/Trident.*rv\:11\./)}function uniqueID(){return"new_"+(Date.now().toString(36)+Math.random().toString(36).substr(2,5)).toUpperCase()}(0<langCataSwitcher.length&&"first login"===userPhase||0===langCataSwitcher.length&&"first login"===userPhase)&&(click=3),$(document).ready(function(){var n;$(window).width()<=900&&($(".header").css("margin","12px 0"),$(".row.header").css("padding-top","16px !important")),$(document).on("click touchstart",".introjs-button, .introjs-bullets li",function(){$(".link-ic .introjs-showElement").parent().addClass("orange-bg"),3===click&&!1===updateDone&&(updateGuide("homepage done"),click=2)}),$(document).on("click touchstart",".introjs-donebutton, .introjs-skipbutton",function(){homePageGuide.exit(),homePageGuideUSANZ.exit(),$(".link-ic").removeClass("orange-bg"),$(window).width()<=900&&$(".header").css("margin","22px 0")}),$(".toggle-password").click(function(){$(this).toggleClass("eye-icon eye-icon-off");var e=$($(this).attr("toggle"));"password"==e.attr("type")?e.attr("type","text"):e.attr("type","password")});var i=$("#feedRecaptcha"),s=!0;$(".give-feedback").on("click",function(){$(window).scrollTop("0"),0<i.length?n=grecaptcha.render("feedRecaptcha",{sitekey:captchaSite,callback:reCaptchaVerify}):s=!1}),$("#search-input, .search-input").on("keyup touchEnd",function(){var o,e=!1;3<=$(this).val().length&&0==e&&(e=!0,o=DOMPurify.sanitize($(this).val()),$.ajax({url:baseUrl+"/search-bar-show",method:"POST",data:{val:$(this).val()},success:function(e){$(".result_search_book").empty(),!0===e.success&&$.each(e.message,function(e,t){var a=(a=t.title).replace(o,"<strong>"+o+"</strong>");$(".result_search_book").append('<li><a href="'+baseUrl+"/book/details/"+t.isbn+'"><img class="" id="'+t.isbn+'" src="'+t.image+'" onerror="imgError(this);" alt="'+t.title+'"><p>'+a+"</p></a></li>")})},done:function(){e=!1}})),0==$(this).val().length&&$(".result_search_book").empty(),isMobile()&&$(".result_search_book").css("width",$(window).width())}),$("#close-feedback-modal").on("click",function(){grecaptcha.reset(n)}),$("#give-public-feedback").on("click",function(){let e=!0;var t,a=$(this).data("url");let o=$("#feedBack");0<i.length&&!checkReCaptcha(n)?(0==$("#feedback-recaptcha").find(".error").length&&(t=DOMPurify.sanitize($("#error_captcha").text()),i.parent().append('<span class="error">'+t+"</span>")),e=!1):$("#feedback-recaptcha").find(".error").remove(),""!==o.val()?($("#feedBack").removeClass("warning"),e&&s?$.ajax({url:a,method:"POST",data:{feedback:o.val(),"g-recaptcha-response":$("#g-recaptcha-response").val()},success:function(e){e.status&&($("#feedBack").val(""),$(".review-book-modal").modal("hide"),$("#feedback-step").remove(),$("#finish-step").css("display","initial"))}}):console.log("Recaptcha is missing! Reload page")):(o.addClass("warning"),a=DOMPurify.sanitize(o.attr("data-error")),0==$(".feedback-txt").find(".error").length&&$(".feedback-txt").append('<span class="error">'+a+"</span>"))}),$(".continue-browsing, .review-book-modal .close").on("click",function(){$(".review-book-modal").modal("hide"),$("#feedBack").val("")}),$("#close-feedback-modal").on("click",function(){0===$("#feedback-step").length&&location.reload()}),currentLang=$("#current_lang").data("lang"),current_region=$("#current_region").data("region"),Cookies.get("default-lang")||Cookies.set("default-lang",currentLang),catalogueLang||Cookies.set("site-lang",currentLang),$(document).on("click","#close-covid-banner",function(e){$(".covid-banner").fadeOut()});var e,t=$("ul.catalog-links li");function a(){var e;Cookies.set("search",""),e=($(window).width()<=767?$(".searchInput #search-input"):$(".search-input")).val();sessionStorage.searchedContent=e,sessionStorage.searchType="description";var t=baseUrl+"/books/all";e&&(t+="?sb=description&s="+e),window.location.href=t}isMobile()?(t=$(".catalog-links .dropdown-menu li"),$(".mobile-catalog-switcher #language-"+currentLang).addClass("active")):$("#language-"+currentLang).addClass("active"),$(".active-catalog").text($("#language-"+currentLang).text()),$(document).on("click",".logout",function(e){var t=$(".box"),a=$(this).data("url");t.attr("class","box active confirm-info ");var o=DOMPurify.sanitize($("#box-msg-yes").text());t.find("#box-confirm").html(o+"<span></span>"),t.find("#box-cancel").text($("#box-msg-no").text()),t.find(".confirm-msg").html($(this).data("msg")),$("body,html").addClass("modal-open scrollable"),t.on("click","#box-confirm",function(){t.off("click"),$(this).addClass("loading"),window.location=a}),t.on("click","#box-cancel",function(){t.removeClass("active confirm-info "),$("body,html").removeClass("modal-open scrollable"),t.off("click")})}),$(document).on("click","#show-forget",function(e){e.preventDefault(),$("#show-forget-pwd-content").click(),$("#box-ok").click()}),$(".example-pager span").empty(),$(".grid-view").show(),$(".list-view").hide(),null!=urlParam("l")&&"true"===urlParam("l")&&(0===(e=$("#my_ic_page")).data("log")?showLoginBox():(e=DOMPurify.sanitize(e.data("url")),window.location=e)),null!=urlParam("r")&&"true"===urlParam("r")&&(showLoginBox(),setTimeout(function(){$("#show-forget-pwd-content").click()},100)),$(".burguerMenu").click(function(){$(".mobileMenu ").hasClass("open-menu")?($(".mobileMenu").removeClass("open-menu"),$(".search.mobile-search-icon").show(),modalFix(function(){$("body,html").removeClass("modal-open")})):($(".mobileMenu").addClass("open-menu"),$(".search.mobile-search-icon").hide(),modalFix(function(){$("body,html").addClass("modal-open")}))}),$(".dropdown-notif").click(function(){setTimeout(function(){isMobile()&&($(".dropdown-notif").hasClass("open")?($(".search.mobile-search-icon").hide(),modalFix(function(){$("body,html").addClass("modal-open")})):($(".search.mobile-search-icon").show(),modalFix(function(){$("body,html").removeClass("modal-open")})))},200)}),isMobile()&&$(".top-sub-menu li").on("click",function(e){$(".menuItem.dropdown").hasClass("open")&&(e.stopPropagation(),$(this).closest(".dropdown").find(".main-menu-item.dropdown-toggle").attr("data-toggle","false"))}),$(".menuItem.dropdown").click(function(){setTimeout(function(){isMobile()&&($(".menuItem.dropdown").hasClass("open")?modalFix(function(){$("body,html").addClass("modal-open")}):modalFix(function(){$("body,html").removeClass("modal-open")}))},200)}),$(".login-btn").on("click",clickCount,function(e){e.preventDefault(),clickCount+=1,login($(this))}),$(document).on("click","#show-forget-pwd-content",function(e){e.preventDefault(),$(".login-modal #login-content").addClass("hidden"),$(".login-modal #forget-content").removeClass("hidden")}),$(document).on("click","#back-login",function(e){e.preventDefault(),$(".login-modal #login-content").removeClass("hidden"),$(".login-modal #forget-content").addClass("hidden")}),$(document).on("click",".show-modal-evolve",function(e){var t=$(".box");t.attr("class","box active confirm-info ");var a=DOMPurify.sanitize($("#box-msg-yes").text());t.find("#box-confirm").html(a+"<span></span>"),t.find("#box-cancel").text($("#box-msg-no").text()),t.find(".confirm-msg").text($("#evolve-msg").text()),$("body,html").addClass("modal-open scrollable"),t.on("click","#box-confirm",function(){window.open("https://evolve.elsevier.com/cs/","_blank"),t.removeClass("active confirm-info "),$("body,html").removeClass("modal-open scrollable"),t.off("click")}),t.on("click","#box-cancel",function(){t.removeClass("active confirm-info "),$("body,html").removeClass("modal-open scrollable"),t.off("click")})}),$(".show-login").on("click",showLoginBox),$(document).on("click",".close",function(){closeModal($(this).closest(".modal"))}),$(window).width()<=767&&($(".search, .search-mobile").on("click",function(){$("body,html").addClass("modal-open"),$(".subMenuSection").slideUp(),$(".searchBarSection").fadeIn()}),$(".container-search .back, .container-search .close").on("click touchStart",function(){$(this).closest(".searchBarSection").fadeOut()}),$(".mobileMenu .search").on("click",function(){$(".menu-expand").slideUp(),$(".burguerMenu").removeClass("open"),$(".searchBarSection").fadeToggle()}),$("#searchActive").on("click",function(){$("#search-input").val(""),$("input[name=type]").removeAttr("checked"),$("#searchTitle").prop("checked",!0)}),$("#searchActive").removeClass("search-desktop"),$(".hidden-mobile").css("display","none")),768<=$(window).width()&&($(".mainMenu .menuItem:not(.search)").unbind("click").on("click",function(){var e=$(this).text();$(".menuItem.active").removeClass("active"),$(this).addClass("active"),$(".searchBarSection").slideUp();var t=$('[data-discipline="'+e+'"]');t.siblings(".subMenuSection").slideUp(),setTimeout(function(){t.slideToggle()},500),t.is(":visible")&&($(this).removeClass("active"),$(".menuItem").removeClass("active"))}),$("#searchActive").addClass("search-desktop"),$(".hidden-desktop").css("display","none")),isMobile(),$(document).on("click",".search-container .searchIcon, .search-desktop",function(){a()}),$(document).on("keypress","#search-input, .search-input",function(e){13===(e.keyCode||e.which)&&a()}),$(".search-mobile,#searchActive").on("click",function(e){setTimeout(function(){$("#search-input").focus()},0)}),$("#search-input").on("focus",function(e){$(this).parent().addClass("focus-input")}),$("#search-input").on("blur",function(e){$(this).parent().removeClass("focus-input")}),$("#langSwitcher").on("change",function(){var e=$(this).find("option:selected").data("flag-class");$(this).parent().find(".flag-icon").prop("class",e)}),$(document).on("change keyup","textarea,input:not(.phone),select",function(){($(this).val()&&$(this).hasClass("warning")||"checkbox"===$(this).attr("type")&&$(this).is(":checked"))&&$(this).removeClass("warning").parent().find(".error").remove()}),$.each($(".retina-reload"),function(e,t){var a,o=$(this).attr("src");0<=o.indexOf("@1x.")&&(a=3<window.devicePixelRatio?3:window.devicePixelRatio<1?1:window.devicePixelRatio,o=o.replace("@1x.","@"+Math.floor(a)+"x.")),$(this).attr("src",o),$(t).trigger("onload")}),$('[data-toggle="tooltip"]').tooltip(),isMobile()||$(".profile-nav").dropdown(),fixLoginModalIpad(),$(".filter-selector-list").select2(),$(document).on("keypress","[data-max-length]",function(e){$(this).val().length>=$(this).data("max-length")&&e.preventDefault()}),$(document).on("change","[data-max-length]",function(e){$(this).val().length>$(this).data("max-length")&&$(this).val($(this).val().substring(0,$(this).data("max-length")))}),$(document).on("keypress",'input[type="number"]',function(e){isNaN(e.key)&&!$(this).hasClass("phone")?e.preventDefault():($(this).hasClass("phone")&&isNaN(e.key)&&("+"!==e.key||0<$(this).val().length)&&e.preventDefault(),0===$(this).val().length&&"+"===e.key&&$(this).val("+"))}),Cookies.get("category-type")||Cookies.set("category-type","hs"),"en"==catalogueLang&&1024<=$(window).width()&&$(".mainMenu .top-sub-menu >li").on("click",function(){Cookies.set("category-type",$(this).parent().data("type")),Cookies.set("search","")}),$("#coversTab .nav-tabs li a").on("click",function(){$("#coversTab .nav-link").removeClass("active"),$("#coversTab .nav-link").attr("aria-selected","false"),$(this).attr("aria-selected","true"),$(this).addClass("active"),$("#coversTab .tab-pane").addClass("hidden"),$("#"+$(this).data("id")).removeClass("hidden")}),$(".language-links .dropdown-menu li a").on("click",function(e){"in"!==currentLang&&(Cookies.set("site-lang",$(this).data("lang")),Cookies.set("switch-catalog",$(this).data("cat")),$.ajax({url:baseUrl+"/clear-books-session",success:function(e){}}),location.reload())}),$(window).width()<=1024?$(".catalog-links li ul li").on("click",function(e){"in"!==currentLang&&(Cookies.set("site-lang",$(this).data("lang")),location.reload())}):$(".catalog-links li").on("click",function(e){"in"!==currentLang&&(Cookies.set("site-lang",$(this).data("lang")),location.reload())}),catalogueLang&&($(".language-links .dropdown-menu li").removeClass("active"),"in"==catalogueLang||"us"==catalogueLang?$("#lang-en").addClass("active"):($("#lang-"+catalogueLang).addClass("active"),$(".active-language").text($("#lang-"+catalogueLang).text())),$("#current_lang").data("lang",catalogueLang)),t.on("click",function(e){Cookies.set("search","");var t=$(this).data("region"),a=$(this).data("lang");Cookies.set("switch-catalog","/"+t+"/"+a+"/"),$.ajax({url:baseUrl+"/clear-books-session",success:function(e){}}),0<$(".home").length?location.reload():window.location.replace("/books/all")}),Cookies.get("category-type")||Cookies.set("category-type","hs"),"en"===catalogueLang&&1024<=$(window).width()&&$(".mainMenu .top-sub-menu >li").on("click",function(){Cookies.set("category-type",$(this).parent().data("type")),Cookies.set("search","")}),$("#coversTab .nav-tabs li a").on("click",function(){$("#coversTab .nav-link").removeClass("active").attr("aria-selected","false"),$(this).attr("aria-selected","true"),$(this).addClass("active"),$("#coversTab .tab-pane").addClass("hidden"),$("#"+$(this).data("id")).removeClass("hidden")}),0<$(".update-version").length&&$(".update-version").on("click",function(){$.ajax({url:baseUrl+"/profile/update-version",method:"GET",dataType:"JSON",success:function(e){$(this).removeClass("update-version")}})});t=DOMPurify.sanitize(window.location.search);const o=new URLSearchParams(t);if("feedback"==(source=o.get("source"))){let e=$("#my_ic_page");0===e.data("log")?showLoginBox():(t=DOMPurify.sanitize(e.data("url")),window.location=t)}$(document).on("click","#update-librarian",function(e){e.preventDefault();var e=new Date,a=e.getDate()+"/"+e.getMonth()+"/"+e.getFullYear();$.ajax({url:$(this).data("url"),method:"POST"}).done(function(e){var t=DOMPurify.sanitize(JSON.stringify(e)),e=JSON.parse(t).file;/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)&&((t=$("<a>")).attr("href","data:application/vnd.ms-word;base64,"+e),$("body").append(t),t.attr("download","Book details("+a+").docx"),t[0].click(),t.remove())}).error(function(){location.reload()})}),$(".link-book").bind("touchstart click",function(e){DOMPurify.sanitize($(this).attr("data-isbn"));var t="";-1<$(this).attr("href").indexOf("shared")&&(t="shared_by_colleague"),""!==(t=-1<$(this).attr("href").indexOf("like")?"you_like":t)&&(e.preventDefault(),$('.nav-link[data-id="'+t+'"').trigger("click")),$(this).parent().removeClass("new-notif"),$.ajax({url:baseUrl+"/profile/update-notification",method:"GET",dataType:"JSON",success:function(e){$("#notifications-count").css("display","none")}})}),$(document).on("mousemove",".singleProduct",function(e){$(".tooltip_booktitle").css({left:e.pageX+15,top:e.pageY-$(window).scrollTop()})})}),$("#new-institution-btn").on("click",function(){var e;"in"!=currentLang&&"us"!==currentCountry&&"united states"!=currentCountry.replace("+"," ")||(e="field",$("#institution_institutionId").prop("disabled",!0),$(".btn-new-institution").addClass("disabled"),0<$(".city-filter").length?e="city":0<$(".state-filter").length&&(e="State"),$(".select2-selection__placeholder").remove(),$("#select2-institution_institutionId-container").append('<span class="select2-selection__placeholder">Select '+e+" above</span>"))}),$("#city_filter_modal,#state_filter_modal").change(function(){"in"!=currentLang&&"us"!=currentLang&&"united states"!==currentCountry||!document.getElementById("institution_institutionId").disabled||($("#institution_institutionId").prop("disabled",!1),$(".btn-new-institution").removeClass("disabled"),$(".select2-selection__placeholder").remove())});let searchParam=DOMPurify.sanitize(window.location.search);var params=new window.URLSearchParams(searchParam);function initPopover(){$('[data-toggle="popover"]').popover().on("show.bs.popover",function(){var e=$(this);$.each($(".popover.in"),function(){e!==$(this)&&$(this).prev().click()})})}function closePopover(){$("body").on("click touch",function(e){"popover"!==$(e.target).data("toggle")&&0===$(e.target).parents(".popover.in").length&&$('[data-toggle="popover"]').popover("hide")})}params.has("forgot-password")&&(showLoginBox(),$(".login-modal #login-content").addClass("hidden"),$(".login-modal #forget-content").removeClass("hidden")),$("#show-forget-pwd-content").on("click",function(){window.history.pushState({},"","?forgot-password")}),$("#back-login,#close-login-modal").on("click",function(){window.history.pushState(null,null,window.location.pathname)}),$(document).ready(function(){$(".update-profile-cookie").fadeOut(5e3),$(document).on("click",".close-btn",function(e){e.preventDefault(),$(this).closest(".update-profile-cookie").remove()}),document.referrer.includes("/books/")?sessionStorage.setItem("source","search"):document.referrer.includes("/book/details")||0!=sessionStorage.getItem("navigate")||sessionStorage.setItem("source","other"),window.location.pathname.includes("/books/")&&sessionStorage.setItem("navigate","true"),$(".navigate a").on("click",function(){sessionStorage.setItem("navigate","true")}),$(".singleProduct a").on("click",function(){sessionStorage.setItem("navigate","false")}),"search"===sessionStorage.getItem("source")&&"false"!=sessionStorage.getItem("navigate")||$(".navigate").remove(),$("#language-name").change(function(){var e=$(this).prop("selectedIndex");$("#catalogues-name").prop("selectedIndex",e)}),$("#catalogues-name").change(function(){var e=$(this).prop("selectedIndex");$("#language-name").prop("selectedIndex",e)}),$("#popuplangcat").submit(function(e){e.preventDefault();var e=$("#popuplangcat").attr("data-url"),t=$("#language-name").val(),a=$("#catalogues-name").val();$.ajax({url:baseUrl+"/clear-books-session",success:function(e){}}),$.ajax({type:"POST",url:e,data:{lang:t,cat:a},success:function(e){Cookies.set("site-lang",t),Cookies.set("switch-catalog",a),location.reload()}})})}),$(document).keyup(function(e){13===e.keyCode&&0<$(".login-modal.active").length&&login($(".login-btn"))}),$("#started-btn").on("click",function(){var a=[];0===$('input[name="choice"]:checked').length?showErrorBox(DOMPurify.sanitize($("#error_interests").text())).find("#box-ok").text($("#box-msg-close").text()):($.each($('input[name="choice"]:checked'),function(e,t){a.push($(this).val())}),$(this).attr("disabled","disabled"),$.ajax({url:$(".user-interests-page").data("update-user"),method:"POST",data:{userInterests:a},success:function(e){e.success&&(window.location.href="/")}}))}),$(window).scroll(function(){var e=$(".header");55<=$(window).scrollTop()?e.addClass("fixed"):e.removeClass("fixed")}),$("body").on("hidden.bs.popover",function(e){$(e.target).data("bs.popover").inState.click=!1});var popup=document.getElementById("languageModal");$("#languageModal").modal("hide"),popup&&(Cookies.get("reloadPage")||Cookies.set("reloadPage","reload"),"reload"===Cookies.get("reloadPage")?($("#languageModal").modal("show"),Cookies.set("reloadPage","reloaded")):localStorage.getItem("firstVisit")?$("#languageModal").modal("hide"):($("#languageModal").modal("show"),localStorage.setItem("firstVisit","true")));var hashCode=DOMPurify.sanitize(window.location.hash);function goToBook(e){var t=sanitizeHTML(e);$(".book_item ").css("background","initial"),$(".tabs-nav #myBooksList a").tab("show"),$(".myBooksList div"+t).offset()&&(e=$(".myBooksList div"+t).offset().top,isMobile()?(setTimeout(function(){$("li.active a").trigger("click")}),window.scrollTo({top:e-600,behavior:"smooth"})):window.scrollTo({top:e-250,behavior:"smooth"}),$(".myBooksList div"+t).parent().parent().css("background","#d6e9f06b")),isMobile()&&$(".title-notif").trigger("click")}hashCode&&goToBook(hashCode),$(".link-book").bind("touchstart click",function(){var e=DOMPurify.sanitize($(this).attr("data-isbn"));""!==e&&-1<$(this).attr("href").indexOf("my-books")?(event.preventDefault(),goToBook("#"+e)):(e=DOMPurify.sanitize($(this).attr("href")),window.location=e)}),$(function(){$.ajax({url:baseUrl+"/save_books-in-session",method:"POST",success:function(e){}})});