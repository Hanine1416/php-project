function validateStep1(){var i=!0,e=$("#verify-account-modal #step1"),t=e.find(".validate:visible");return t.removeClass("warning"),e.find(".error").remove(),$.each(t,function(e,t){var n;$(t).val()||(n=DOMPurify.sanitize($(t).prop("title")),$(t).addClass("warning").parent().append('<span class="error">'+n+"</span>"),i=!1)}),i}function validateStep2(){var e=!0,t=$("#url"),n=$("#url"),i=$(".url-and-upload-fields");i.removeClass("warning").parent().find(".error").remove();var o=0===$(".dropzone")[0].dropzone.getAcceptedFiles().length;return(null===n.val()||"undefined"===n.val()||""===n.val())&&o&&!$("#dropzone-upload").hasClass("has-file")?(n=DOMPurify.sanitize(n.prop("title")),i.addClass("warning").parent().append('<span class="error" style="position: initial">'+n+"</span>"),e=!1):ValidURL(t.val())&&($(".url-and-upload-fields").removeClass("warning"),$(".url-file-container .error").remove()),e}Dropzone.autoDiscover=!1,$(document).ready(function(){var i=$(".box");i.find("#box-confirm").text($("#box-msg-yes").text()),i.find("#box-cancel").text($("#box-msg-no").text());var e=$("#institutions-selector-0"),v=$("#program-selector-0"),r=new FormData,c={},f=1;function o(){let e=$("#verify-account-modal #step1"),t=$("#verify-account-modal #url"),n=$("#institutions-selector-0");$(".modal-step").removeClass("active"),n.val("").trigger("change"),$("#verify-account-modal #program-selector-0").val("").trigger("change"),$("#verify-account-modal #institutionName").val(""),t.val(t.data("user-url")),e.addClass("active"),$(".dropzone")[0].dropzone.removeAllFiles(),$(".institution-program-block .block").remove();var i=$("#verify-account-modal #single-institution").data("institutions-length");$(".block-0 .institution-selector-block").show(),$(".block-0 .institution-text-block").hide(),$(".block-0 .btn-cancel-new-institution").parent().hide(),0==i&&($(".block-0 .institution-selector-block").hide(),$(".block-0 .institution-text-block").show(),$(".block-0 .btn-cancel-new-institution").parent().hide()),f=1}e.select2({placeholder:"",dropdownParent:e.parent()}),v.select2({placeholder:"",dropdownParent:v.parent()}),$(".dropzone").each(function(e,t){$(t).find(".upload-btn").on("click",function(e){e.preventDefault(),$(t).click(),$(this).blur()});var n="g_"+$(t).data("field"),i=new Dropzone(t,{url:window.location.pathname,parallelUploads:100,maxFiles:1,paramName:n,thumbnailHeight:120,thumbnailWidth:100,addRemoveLinks:!0,resizeWidth:100,resizeHeight:120,dictDefaultMessage:$(t).data("drag-msg"),dictRemoveFile:$(t).data("delete-msg"),acceptedFiles:".rtf,.doc, .docx, .png , .pages, .jpg,.pdf",autoProcessQueue:!1}).on("complete",function(e){i.removeFile(e)}).on("addedfile",function(e){var t=e.name.split(".").pop();$(".dropzone").removeClass("file-img"),$(".url-and-upload-fields").removeClass("warning"),$(".url-file-container .error").remove(),"png"!==t&&"jpg"!==t&&"jpeg"!==t&&(this.emit("thumbnail",e,"/assets/img/file-icon/file.png"),$(".dropzone").addClass("file-img")),$("#update-detail-btn").attr("disabled",!1),1e6<e.size&&(showErrorBox($("#max-size-file-upload").text()),i.removeFile(e))}).on("removedfile",function(){$("#update-detail-btn").attr("disabled",!profileBlockChanged($("#edit-details-form")))})}),$("#dropzone-upload").hasClass("has-file")&&(e=DOMPurify.sanitize($(".dropzone").data("delete-msg")),$(".dropzone").append('<div class="dz-preview dz-file-preview">\n  <div class="dz-image"><img data-dz-thumbnail src="/assets/img/file-icon/file.png"/></div>\n<a class="dz-remove delete-img" href="javascript:undefined;" >'+e+"</a> </div>")),$(".delete-img").on("click",function(){$(".dz-file-preview").remove(),$("#dropzone-upload").removeClass("has-file")}),$(document).on("click","#verify-btn",function(){o(),$("#verify-account-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")})}),$(document).on("click",".ctaDetails #verify-btn, .read-now-btn #verify-btn",function(){o(),$("#verify-account-modal #step1").removeClass("active"),$("#verify-account-modal #step0").addClass("active"),$("#verify-account-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")})}),$(document).on("click","#pending-btn",function(){$("#pending-qualification-modal #step1").addClass("active"),$("#pending-qualification-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")})}),$(document).on("click","#verify-account-modal #close-modal",function(e){$(".modal-copy-container").scrollTop(0);var t=$("#verify-account-modal"),n=t.find(".modal-step.active").attr("id");localStorage.removeItem("readingListId"),"step3"===n||"step0"===n?(closeModal(t),o()):(i.attr("class","box active confirm-info"),i.find(".confirm-msg").text($("#cancel-list-msg").text()),$("body").addClass("box-above-modal"),i.on("click","#box-cancel",function(){i.removeClass("active confirm-info"),i.off("click"),$("body").removeClass("box-above-modal")}).on("click","#box-confirm",function(){i.removeClass("active confirm-info"),closeModal(t),i.off("click"),$("body").removeClass("box-above-modal"),o()}))}),$(document).on("click","#pending-qualification-modal #close-modal",function(e){closeModal($("#pending-qualification-modal"))}),$(document).on("click","#verify-account-modal .goStep:not(.loading)",function(e){e.preventDefault();var e=$(this).data("target-step"),o=!0;switch(e){case"step2":o=validateStep1();let t,n;var a;let i;if(c.institutions=[],o)for(let e=0;e<f;e++)t=$("#institutions-selector-"+e+" option:selected"),n=$("#program-selector-"+e+" option:selected"),i=""!=t.text()?$.trim(t.text()):$("#institutions-selector-"+e).parent().parent().find("#institutionName").val(),a={institutionName:i,institutionId:t.attr("value"),programName:$.trim(n.text())},c.institutions.push(a);break;case"step3":var o=validateStep2(),l=$("#verify-account-modal #url"),s=$(".dropzone")[0];c.file=!1,o&&(null!=l.val()&&""!==l.val()&&(c.url=l.val()),0<s.dropzone.getAcceptedFiles().length&&(r.set("userFile",$(".dropzone")[0].dropzone.getAcceptedFiles()[0]),c.file=!0),o=!1,s=c,validateStep2()&&function(n,i){var o=$("#submit-request-btn");o.addClass("loading"),$.ajax({url:$("#formVerifyAccount").data("url"),method:"POST",data:n,success:function(t){!0===n.file?$.ajax({url:baseUrl+"/upload-file",method:"post",data:r,processData:!1,contentType:!1,success:function(e){e.success?(o.removeClass("loading"),i(t.success,n,t)):showErrorBox(e.message)}}):(o.removeClass("loading"),i(t.success,n,t))},error:function(e){o.removeClass("loading"),401===e.status&&showErrorBox($("#loggedOutMsg").text())}})}(s,function(e,t,n){var i;e&&(i=$("#verify-btn"),e=$(".featuredSection").find(".not-qualified-banner-block"),$("#verify-account-modal #step2").removeClass("active"),$("#verify-account-modal #step3").addClass("active"),0<e.length&&e.remove(),i.addClass("pending"),i.parent().hasClass("ctaDetails")||i.parent().hasClass("read-now-btn")?$(".pending").attr("id","pending-btn"):($(".pending").removeAttr("id"),i.text($("#pending-btn").text())))}))}o&&($(this).closest(".modal-step").removeClass("active"),$("#verify-account-modal #"+e).addClass("active"))}),$(document).on("click","#new-block-btn",function(e){e.preventDefault();var t=$("#verify-account-modal #single-institution"),n=$("#validation-msg").text(),i=$("#select-institution").text(),o=$("#select-program").text(),a=$("#institution").text(),l=$("#add-btn").text(),s=$("#cancel-btn").text(),r=$("#contextual-help-inst").text(),c="display: block;",e="display: none;";0==t.data("institutions-length")&&(c="display: none;",e="display: block;");n='  <div class="institution-block block block-'+f+'" ><div class="small-12 medium-12 large-12 columns input-step pl-0 pr-0 right"><a id="delete-block-btn"></a></div><div class="small-12 medium-12 large-12 columns input-step institution-selector-block pl-0 pr-0 mb-24" style="'+c+'">\n                                    <label class="label-title"\n                                           for="institutions-selector-'+f+'">'+i+'</label>\n                                    <select name="institutions-list" id="institutions-selector-'+f+'" class="validate"\n                                             title="'+n+'"\n                                        <option value=""></option>\n                                    </select>\n                                <div class="">\n                                            <a class="pull-right btn-new-institution decorate">'+l+'</a>\n                                        </div>\n                                        <span class="contextual-txt mb-0">'+r+'</span>\n                                </div>\n                                    <div class=" input-step institution-text-block small-12 medium-12 large-12 columns pl-0 pr-0 mb-24" style="'+e+'">\n                                        <label for="institutionName">'+a+'</label>\n                                        <input type="text" id="institutionName" name="institutionName" class="institution-name validate" title="'+n+'">\n                                        <div class="small-12 medium-12 large-12 columns  pl-0 pr-0 hidden" style="'+c+'">\n                                            <a class="pull-right btn-cancel-new-institution decorate ">'+s+'</a>\n                                        </div>\n                                    </div>\n                                <div class="small-12 medium-12 large-12 columns input-step pl-0 pr-0 mb-24">\n                                    <label for="program-selector-'+f+'"\n                                           class="label-title ">'+o+'</label>\n                                    <select name="professions-list" id="program-selector-'+f+'" class="validate"\n                                            title="'+n+'"\n                                            placeholder="">\n                                        <option value=""></option>\n                                    </select>\n                                </div></div>',n=DOMPurify.sanitize(n);$(".institution-program-block").append(n);var d,u,p,n=t.data("professions");for(p in $("#institutions-selector-"+f).select2({placeholder:"",dropdownParent:$("#institutions-selector-"+f).parent()}),$("#program-selector-"+f).select2({placeholder:"",dropdownParent:v.parent()}),t=t.data("country"),d=$("#institutions-selector-"+f),$.post(baseUrl+"/institutions",{country:t,city:"",zipCode:"",state:""},function(e){if(d.html("<option value=''></option>"),e.status){for(var t in d.parent().show(),d.parent().removeClass("hidden"),e.results){var n=new Option;n.text=e.results[t].name,n.value=t,n.setAttribute("data-type",e.results[t].type);n=DOMPurify.sanitize(n);d.append(n)}200<Object.keys(e.results).length&&isIE()&&d.select2({minimumInputLength:2}),d.parent().find(".warning").removeClass("warning"),d.parent().find(".error").remove(),$(".select2-selection__placeholder").remove()}u&&u()}),n){var m=new Option;m.text=p,m.value=p,m.setAttribute("data-type",p);m=DOMPurify.sanitize(m);$("#program-selector-"+f).append(m)}f++}),$(document).on("click","#delete-block-btn",function(e){e.preventDefault(),$(this).parent().parent().remove()}),$(document).on("click",".btn-new-institution",function(){var e=$(this).closest(".institution-block");e.find(".institution-selector-block").hide(),e.find(".institution-text-block").show(),e.find(".btn-cancel-new-institution").parent().show()}),$(document).on("click",".btn-cancel-new-institution",function(){var e=$(this).closest(".institution-block");e.find(".institution-selector-block").show(),e.find(".institution-text-block").hide(),e.find(".btn-cancel-new-institution").parent().hide()}),$(document).on("click",".controls_books .request, .read-now-btn a",function(){var e=($(this).attr("data-isbn")?$(this):$(this).parent()).attr("data-isbn");console.log(e),e&&$.post(baseUrl+"/save-book",{isbn:e})})}),$("#verify-account-modal #single-institution").on("select2:open",function(e){var t="scroll.select2";$(e.target).parents().off(t),$(window).off(t)});