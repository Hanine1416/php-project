function institutionBlockChanged(t){var n=!1;return $.each(t.find("select,input"),function(t,i){if(n="checkbox"===$(i).attr("type")&&$(i).prop("checked")!=$(i).data("value")||$(i).val()!=$(i).data("value")&&(null!==$(i).val()||""!=$(i).data("value"))&&"hidden"!==$(i).attr("type")&&"checkbox"!==$(i).attr("type")?!0:n)return!1}),n}function loadInstitutionInsideModal(t){var i=t.closest(".institution-details-block"),n=i.data("inst-id"),o=i.data("institution-id"),a=i.data("institution-name"),e=i.data("department-id"),s=i.data("department-name"),d=i.data("profession"),t=i.data("speciality"),i=i.data("primary");$("#primary-block").css("display",i?"none":"block"),$("#institution_id").val(n),o?$("#institution_institutionId").data("value",o).val(o).trigger("change.select2").trigger("change"):$(".btn-new-institution").click(),$("#institution_institutionName").data("value",a).val(a),e?$("#institution_departmentId").data("value",e).append('<option selected value="'+e+'">'+s+"</option>"):$(".btn-new-department").click(),$("#institution_departmentName").data("value",s).val(s),$("#institution_profession").data("value",d).val(d).trigger("change.select2"),$("#institution_speciality").data("value",t).append('<option value="'+t+'" selected>'+t+"</option>"),$("#institution_isPrimary").data("value",i).prop("checked",i)}$(document).ready(function(){$('[data-toggle="popover"]').popover();var s=$(".box"),t=DOMPurify.sanitize($("#box-msg-yes").text());s.find("#box-confirm").html(t+" <span></span>");t=DOMPurify.sanitize($("#box-msg-no").text());s.find("#box-cancel").text(t),$(document).on("click","#new-institution-btn",function(t){t.preventDefault(),modalFix(function(){$("body,html").addClass("modal-open scrollable")}),$("#institution-form").find(".input-field").removeClass("readOnly"),$(".institution-modal").removeClass("edit-mode").addClass("active").fadeIn(200,function(){$(".institution-modal  .close-institution-modal").show()})}),$(document).on("click",".edit-institution-btn",function(t){t.preventDefault(),modalFix(function(){$("body,html").addClass("modal-open scrollable")}),loadInstitutionInsideModal($(this)),$(this).closest(".institution-details-block").data("has-request")&&($(".institution-modal #disableInstitution").removeClass("hidden"),$(".institution-modal #deleteInstitution").addClass("hidden"),setTimeout(function(){$(".institution-modal .fieldset .input-field:not(#primary-block)").addClass("readOnly")},500)),$(".institution-modal").addClass("active edit-mode").fadeIn(200,function(){$(".institution-modal  .close-institution-modal").show()})}),$(document).on("change keyup",".institution-modal.edit-mode input,.institution-modal.edit-mode select",function(){var t=$(this).closest(".institution-block");t.find("#updateInstitution").attr("disabled",!institutionBlockChanged(t))}),$(document).on("click",".close-institution-modal",function(t){$("#updateInstitution").attr("disabled")?$(".institution-modal").hasClass("active")&&closeInstitutionModal():($("body").addClass("box-above-modal"),s.attr("class","box active confirm-info"),s.find(".confirm-msg").text($("#confirm-close-msg").text()),s.on("click","#box-cancel",function(){s.removeClass("active confirm-info"),s.off("click"),$("body").removeClass("box-above-modal")}).on("click","#box-confirm",function(){s.removeClass("active confirm-info"),closeInstitutionModal(),s.off("click"),$("body").removeClass("box-above-modal")})),$(".institution-modal .fieldset .input-field:not(#primary-block)").removeClass("readOnly")}),$(document).on("click","#addInstitution",function(t){t.preventDefault();var n=$(this).closest("form");submitInstitutionFromModal(n,!0,function(t){var i;t.success&&($(".country-block").remove(),i=$("#institutions-container"),t.institution.primary?($('.institution-details-block[data-primary="1"]').data("primary",0),i.prepend(t.view)):0<(i=$(".institution-details-block.disabled-inst").first()).length?$(t.view).insertBefore(i):$(t.view).insertBefore(".add-institution-button"),closeInstitutionModal()),n.removeClass("loading")})}),$(document).on("click","#updateInstitution",function(t){t.preventDefault();var o=$(this).closest("form"),i=o.find(".institution-details-block").data("has-request"),t=$("#deleteInstitution");t.text(i?t.data("disable"):t.data("delete")),submitInstitutionFromModal(o,!1,function(t){var i,n;o.find(".fieldset").addClass("readOnly"),t.success&&(i=$("#institutions-container"),n=$(".institution-details-block[data-inst-id='"+t.institution.id+"']"),t.institution.primary?($('.institution-details-block[data-primary="1"]').data("primary",0),i.prepend(t.view),n.remove()):n.replaceWith(t.view),closeInstitutionModal()),o.removeClass("loading")})}),$(document).on("click","#deleteInstitution",function(){var a=$(this).closest(".institution-block"),e=$("#institution_id").val();s.attr("class","box active confirm-info"),s.find(".confirm-msg").text($("#delete-institution-msg").text()),s.find("#box-cancel").css("display",""),s.on("click","#box-confirm",function(){var o=$(this);o.prev().hide(),$.ajax({url:baseUrl+"/user/institution",method:"delete",data:{institution:e},dataType:"JSON",beforeSend:function(){a.addClass("loading"),o.addClass("loading")},success:function(t){var i,n;o.removeClass("loading"),t.success?(n=DOMPurify.sanitize(e),i=$('.institution-details-block[data-inst-id="'+n+'"]'),n=DOMPurify.sanitize(t.primary),DOMPurify.sanitize(a.find(".isPrimary").data("value"))&&$('.institution-details-block[data-inst-id="'+n+'"]').data("primary",1),t.disabled?(i.addClass("disabled-inst"),i.insertBefore(".add-institution-button")):i.remove(),closeInstitutionModal(),s.removeClass("active confirm-info"),o.prev().show()):showErrorBox(t.reply),a.removeClass("loading"),o.removeClass("loading")},error:function(t){a.removeClass("loading"),o.removeClass("loading"),401===t.status?showErrorBox($("#loggedOutMsg").text()):showErrorBox($("#error").text())}}),s.off("click")}),s.on("click","#box-cancel",function(){s.attr("class","box"),s.off("click")})}),$(document).on("click","#disableInstitution",function(){var n=$(this).closest(".institution-block"),o=$("#institution_id").val(),a=$(this);$.ajax({url:baseUrl+"/user/institution/disable",method:"PUT",data:{institution:o},dataType:"JSON",beforeSend:function(){a.addClass("loading"),n.addClass("loading")},success:function(t){var i;t.success?(i=DOMPurify.sanitize(o),i=$('.institution-details-block[data-inst-id="'+i+'"]'),DOMPurify.sanitize(t.primary),n.find(".isPrimary").data("value")&&$('.institution-details-block[data-inst-id="'+dprimary+'"]').data("primary",1).prependTo("#institutions-container"),i.addClass("disabled-inst"),i.insertBefore(".add-institution-button"),closeInstitutionModal()):showErrorBox(t.reply),n.removeClass("loading"),a.removeClass("loading")},error:function(t){n.removeClass("loading"),a.removeClass("loading"),401===t.status?showErrorBox($("#loggedOutMsg").text()):showErrorBox($("#error").text())}})})});