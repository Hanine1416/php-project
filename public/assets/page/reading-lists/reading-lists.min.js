function showStepOne(){$("#share-book-modal #step1").addClass("active")}$(document).ready(function(){function c(){let t=$(".tabs-nav li").length;$(".requested_books #copy-book-btn").each(function(){var e=this.getAttribute("data-isbn");$(".block_cover_book[id="+e+"]").length==t?($(".requested_books #copy-book-btn[data-isbn="+e+"]").addClass("isDisabled"),$(".requested_books #copy-book-btn[data-isbn="+e+"] a").addClass("isDisabled")):($(".requested_books #copy-book-btn[data-isbn="+e+"]").removeClass("isDisabled"),$(".requested_books #copy-book-btn[data-isbn="+e+"] a").removeClass("isDisabled"))})}c();var e=DOMPurify.sanitize(window.location.hash),i=!1;function a(e){var t;$(".book_item ").css("background","initial"),$(".tabs-nav #myBooksList a").tab("show"),$(".myBooksList div"+e).offset()&&(t=$(".myBooksList div"+e).offset().top,isMobile()?(setTimeout(function(){$("li.active a").trigger("click")}),window.scrollTo({top:t-600,behavior:"smooth"})):window.scrollTo({top:t-250,behavior:"smooth"}),$(".myBooksList div"+e).parent().parent().css("background","#d6e9f06b")),isMobile()&&$(".title-notif").trigger("click")}e&&a(e),$(".link-book").on("touchstart click",function(e){var t=DOMPurify.sanitize($(this).attr("data-isbn"));""!==t&&-1<$(this).attr("href").indexOf("my-books")?(e.preventDefault(),a("#"+t)):window.location=DOMPurify.sanitize($(this).attr("href"))}),initPopover(),closePopover(),z($("#reading-list-content .input-section-name"));var n={},o=$(".box");o.find("#box-confirm").text($("#box-msg-yes").text()),o.find("#box-cancel").text($("#box-msg-no").text());var t,s=sanitizeHTML(localStorage.getItem("readingListId"));function r(a,n){$.ajax({url:"/reading-list-remove-book",method:"GET",data:{isbn:a.isbn,readingListID:n,option:"",bookTitle:a.title},async:!1,success:function(t){if(!0===t.Result){$('.tab-pane.active #book-item[data-isbn="'+a.isbn+'"]')[0].style.display="none",$('.tab-pane.active #book-item[data-isbn="'+a.isbn+'"]')[0].remove();let e=$("div").find("[data-id='"+n+"']").children().children().eq(1);var i=e.text().match(/\d+/)[0],t=e.text().replace(/[0-9]+/,i-1);e.text(t),i-1==0&&((i=$(".tab-pane#"+n)).find(".list_reading_books.have-books").hide(),i.find(".list_reading_books.no-books").show(),i.find("li.export-list .export-list-btn").parent().hide(),i.find(".add-section-bloc, .new-section-bloc, .NewSection").hide()),v(),m(),c()}}})}function m(){$(".drop-zone").each(function(e,t){for(var i=0;i<t.children.length;i++)-1===t.children[i].className.indexOf("draggable")&&t.children[i].remove();0===t.children.length?(t.classList.add("empty-zone"),t.classList.add("placeholder")):t.classList.remove("empty-zone")})}function d(e){let t=$("#"+e+"-step1");$(".modal-step").removeClass("active"),t.addClass("active"),$("#reading-lists-check-container .multi_institutions").prop("checked",!1)}function l(){$("#close-modal").show(),$("#cancel-remove").show();let e=$("#step1");$(".modal-step").removeClass("active"),e.addClass("active"),$("#remove-book-modal .reason").prop("checked",!1),$("#remove-book-modal #remove-one").prop("checked",!0),$("#advanced").prop("checked",!0),$("#other_reason_block").css("display","none"),$("#other_reason_block textarea").val("")}function b(e){e.parent().removeClass("show-more-menu"),e.attr("aria-hidden",!0)}function p(){$(".export-books-modal").hide(),$(".books-filtered").html(""),$("input:checkbox").prop("checked",!1),localStorage.removeItem("readingListId")}function v(){var e=document.querySelectorAll(".draggable"),t=document.querySelectorAll(".drop-zone");!function(e){for(const t of e)!function(e){e.addEventListener("dragstart",u),e.addEventListener("drag",h),e.addEventListener("dragend",f),e.setAttribute("draggable","true")}(t)}(e),function(e){for(var t of e)!function(e){e.addEventListener("dragenter",g),e.addEventListener("dragover",k),e.addEventListener("dragleave",x),e.addEventListener("drop",y)}(t)}(t)}function u(e){var t,i;_(),this.classList.add("dragged","drag-feedback"),e.dataTransfer.setData("type/dragged-box","dragged"),e.dataTransfer.setData("text/plain",this.textContent.trim()),t=this,i="drag-feedback",setTimeout(()=>{t.classList.remove(i)})}function h(){}function f(){_(!1),this.classList.remove("dragged"),jQuery(".drop-zone").each(function(e,t){for(var i=0;i<t.children.length;i++)-1===t.children[i].className.indexOf("draggable")&&t.children[i].remove();0===t.children.length?(t.classList.add("empty-zone"),t.classList.add("placeholder")):t.classList.remove("empty-zone")})}function g(e){e.dataTransfer.types.includes("type/dragged-box")&&this.classList.add("over-zone")}function k(e){e.dataTransfer.types.includes("type/dragged-box")&&e.preventDefault()}function x(e){}function y(e){let t=document.querySelector(".dragged");e.currentTarget.appendChild(t);var i=t.getAttribute("data-isbn"),a=t.getAttribute("data-reading-list-id"),n=e.currentTarget.getAttribute("data-section-name");$.ajax({url:"/reading-list-book-category-update",method:"put",data:{readingListID:a,isbn:i,category:n},success:function(e){}}),e.preventDefault()}function _(e=!0){for(const t of document.querySelectorAll(".drop-zone"))e?t.classList.add("active-zone"):(t.classList.remove("active-zone"),t.classList.remove("over-zone"))}"true"==sanitizeHTML(localStorage.getItem("addedListSelected"))&&null!=s&&(t=$(".tabs-nav ul"),e=$("#reading-list-content"),t.find("li").removeClass("active"),e.find(".tab-pane").removeClass("active"),e.find(".tab-pane#"+s).addClass("active"),t.find("a[data-id='"+s+"']").parent().addClass("active"),localStorage.removeItem("addedListSelected"),localStorage.removeItem("readingListId")),$(document).on("click",".reading_list_modal #close-modal,#finish-move-book",function(e){return e.preventDefault(),d(DOMPurify.sanitize(localStorage.getItem("action"))),modalFix(function(){$("body,html").removeClass("modal-open active-request scrollable"),$("#action-book-modal").hide().removeClass("active")}),"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.scrollTo(0,0),$("html,body").animate({scrollTop:0},"slow"),!1}),$(".tabs-nav").on("click",function(){$('[data-toggle="tooltip"]').tooltip(),initPopover(),closePopover()}),$("body").on("click","#move-book-btn",function(t){if(t.preventDefault(),$(this).find(".more-menu-btn").hasClass("isDisabled"))return!1;var e=$(".loader-list .loading-spinner");e.show(),$("html,body").animate({scrollTop:0},"slow");let i="move";localStorage.setItem("action",i);var a=$(this).data("isbn"),n=$(this).data("reading-list-id");localStorage.setItem("selectedIsbn",a),localStorage.setItem("reading-list-id",n),localStorage.setItem("title",$(this).data("title")),localStorage.setItem("author",$(this).data("author")),$.ajax({url:"/reading-list-copy-move-modal",method:"get",data:{isbn:a,action:i},dataType:"html",success:function(e){0===e.length||2===e.length?document.location.reload():(t.preventDefault(),d(i),$("#action-book-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")}),e=DOMPurify.sanitize(e),$("#action-book-modal-content").html(e))},complete:function(){$("#action-book-modal .reading-list-item :checkbox").change(function(){0===$("#action-book-modal .reading-list-item :checkbox:checked").length?$("#copy-book-reading-list,#move-book-reading-list").addClass("btnDisabled"):$("#copy-book-reading-list,#move-book-reading-list").removeClass("btnDisabled")}),e.hide()}})}),$(document).on("click","#move-book-reading-list",function(e){e.preventDefault();var s,d,t=$("#copy-move input:checked"),l={readingLists:[]},e=$("div .reading-list-item").find($("input")).length;localStorage.removeItem("readingListId"),0<t.length&&($.each(t,function(e,t){l.readingLists.push({id:$(t).val()})}),l.isbn=DOMPurify.sanitize(localStorage.getItem("selectedIsbn")),l.title=DOMPurify.sanitize(localStorage.getItem("title")),l.existInAll=t.length===e,s=$(".tabs-nav  li.active a").data("id"),d=$(".tabs-nav  li.active .book-name").text(),$.when($.when($.ajax({url:"reading-list-book-content",method:"GET",data:{isbn:l.isbn,readingListID:s,existInAll:l.existInAll},success:function(e){l.book=e}})).then(function(){var n,e,t;e=s,t=d,(n=l).action=DOMPurify.sanitize(localStorage.getItem("action")),n.bookTitle=DOMPurify.sanitize(localStorage.getItem("title")),n.listName=t,$.when($.ajax({url:"/add-book",method:"POST",data:n,async:!1,beforeSend:function(){$(this).addClass("loading")},success:function(e){e.success?($(".modal-step").removeClass("active"),closeModal($("#action-book-modal")),$("#copy-remove-success .cookies-content").text($("#move-book-msg").text()),$(".update-notif").show(),$(".update-notif").fadeOut(5e3),$(document).on("click",".close-btn",function(e){e.preventDefault(),$(this).closest(".update-notif").remove()}),localStorage.removeItem("selectedIsbn"),localStorage.setItem("readingListId",n.readingLists[0].id),$(this).removeClass("loading"),n.readingLists.forEach(e=>{var t=$("div").find("[data-id='"+e.id+"']").children().children().eq(1).text().match(/\d+/)[0],i=$("div").find("[data-id='"+e.id+"']").children().children().eq(1).text().replace(/[0-9]+/,parseInt(t)+1);$("div").find("[data-id='"+e.id+"']").children().children().eq(1).text(i);e=DOMPurify.sanitize(e.id);let a=$("div[data-title='"+e+"']").first();0===parseInt(t)?((e=$(".tab-pane#"+e)).find(".list_reading_books.have-books").show(),e.find(".list_reading_books.no-books").hide(),e.find(".add-section-bloc").show(),e.find(".new-section-bloc").show(),e.find(".new-section-bloc .input-section-name").val($(".initial-section-name").text()),e.find("li.export-list .export-list-btn").parent().show(),0<a.length&&-1!==a[0].className.indexOf("empty-zone")&&a[0].classList.remove("empty-zone"),a.html(n.book)):a.append(n.book)})):console.log("erreur")}})).then(function(){r(n,e)});let i=$("div").find("#copy-book-btn[data-isbn='"+l.isbn+"']"),a=$("div").find("#move-book-btn[data-isbn='"+l.isbn+"']");for(var o=0;o<i.length;o++)i[o].children[0].classList.remove("isDisabled"),a[o].children[0].classList.remove("isDisabled")})))}),$(document).on("click","#remove-list-btn",function(e){var t=$(".box");t.find("#box-confirm").text($("#btn-confirm").text()),t.find("#box-cancel").text($("#cancel-btn").text()),t.attr("class","box active confirm-info"),t.find(".confirm-msg").text($("#remove-list-text").text()),t.find("#box-cancel").css("display",""),t.on("click","#box-confirm",function(){t.removeClass("active error-info"),t.off("click"),$("#box-confirm").addClass("loading"),$.ajax({url:"/reading-list-remove-list",method:"DELETE",data:{readingListID:$(".tabs-nav  li.active a").data("id")},async:!1,beforeSend:function(){$("#box-confirm").addClass("loading")},success:function(e){$(".tabs-nav  li.active").remove(),$(".tab-pane.active").remove(),$(".tabs-nav  li a").first().click(),0==$(".tabs-nav li").length&&($("#reading-list-content").remove(),$(".list_reading_books").show()),$("#box-confirm").removeClass("loading"),$(".update-profile-cookie").show(),$(".update-profile-cookie").fadeOut(5e3),$(document).on("click",".close-btn",function(e){e.preventDefault(),$(this).closest(".update-profile-cookie").remove()})}}),$("#box-confirm").removeClass("loading")}),t.on("click","#box-cancel",function(){t.removeClass("active error-info"),t.off("click")})}),$(document).on("click","#cancel-remove-list,#close-remove-list-modal,#browse_btn_remove_list",function(e){return $("#remove-list-modal").hide().removeClass("active"),modalFix(function(){$("body,html").removeClass("modal-open active-request scrollable"),$("#action-book-modal").hide().removeClass("active")}),!1}),$(document).on("click","#copy-book-btn",function(e){if($(this).find(".more-menu-btn").hasClass("isDisabled"))return!1;var t=$(".loader-list .loading-spinner");t.show(),$("html,body").animate({scrollTop:0},"slow");var i=$(this).data("isbn");let a="copy";localStorage.setItem("action",a),localStorage.setItem("selectedIsbn",i);var n=$(this).closest(".draggable")[0].innerHTML;localStorage.setItem("title",$(this).data("title")),localStorage.setItem("author",$(this).data("author")),localStorage.setItem("bookRender",n),$.ajax({url:"/reading-list-copy-move-modal",method:"get",data:{isbn:i,action:a},dataType:"html",success:function(e){0===e.length||2===e.length?document.location.reload():(e=DOMPurify.sanitize(e),$("#action-book-modal-content").html(e),d(a),$("#action-book-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable"),window.innerWidth<640&&$(".modal-step-content").css("minHeight",$("#copy-book-modal").height()-86)}))},complete:function(){$("#action-book-modal .reading-list-item :checkbox").change(function(){0===$("#action-book-modal .reading-list-item :checkbox:checked").length?$("#copy-book-reading-list,#move-book-reading-list").addClass("btnDisabled"):$("#copy-book-reading-list,#move-book-reading-list").removeClass("btnDisabled")}),t.hide()}}),c()}),$(document).on("click",".reading_list_modal #close-modal,#finish-copy-book",function(e){return e.preventDefault(),d(DOMPurify.sanitize(localStorage.getItem("action"))),modalFix(function(){$("body,html").removeClass("modal-open active-request scrollable"),$("#action-book-modal").hide().removeClass("active")}),!1}),$(document).on("click","#copy-book-reading-list",function(e){e.preventDefault(),$("#copy-book-reading-list").prop("disabled",!0);var t=$("#copy-move input:checked"),i={readingLists:[]},a=$(".tabs-nav  li.active a").data("id"),e=$("div .reading-list-item").find($("input")).length;if(0<t.length){$.each(t,function(e,t){i.readingLists.push({id:$(t).val()})}),i.isbn=DOMPurify.sanitize(localStorage.getItem("selectedIsbn")),i.existInAll=t.length===e;let n="";$.when($.ajax({url:"reading-list-book-content",method:"GET",data:{isbn:i.isbn,readingListID:a,existInAll:i.existInAll},success:function(e){n=e}})).then(function(){i.action="copy",i.bookTitle=DOMPurify.sanitize(localStorage.getItem("title")),i.listName=$(".tabs-nav  li.active .book-name").text(),$.ajax({url:"/add-book",method:"POST",data:i,beforeSend:function(){$(this).addClass("loading")},success:function(e){e.success&&($(".modal-step").removeClass("active"),closeModal($("#action-book-modal")),$("#copy-remove-success .cookies-content").text($("#copy-book-msg").text()),$(".update-notif").show(),$(".update-notif").fadeOut(5e3),$(document).on("click",".close-btn",function(e){e.preventDefault(),$(this).closest(".update-notif").remove()}),localStorage.removeItem("selectedIsbn"),localStorage.setItem("readingListId",i.readingLists[0].id),i.existInAll&&($("div").find("#copy-book-btn[data-isbn='"+i.isbn+"'] a").addClass("isDisabled"),$("div").find("#move-book-btn[data-isbn='"+i.isbn+"'] a").addClass("isDisabled")),i.readingLists.forEach(e=>{var t=$("div").find("[data-id='"+e.id+"']").children().children().eq(1).text().match(/\d+/)[0],i=$("div").find("[data-id='"+e.id+"']").children().children().eq(1).text().replace(/[0-9]+/,parseInt(t)+1);$("div").find("[data-id='"+e.id+"']").children().children().eq(1).text(i);e=DOMPurify.sanitize(e.id);let a=$("div[data-title='"+e+"']").first();0===parseInt(t)?((e=$(".tab-pane#"+e)).find(".list_reading_books.have-books").show(),e.find(".list_reading_books.no-books").hide(),e.find("li.export-list .export-list-btn").parent().show(),e.find(".add-section-bloc").show(),e.find(".new-section-bloc").show(),0<a.length&&-1!==a[0].className.indexOf("empty-zone")&&a[0].classList.remove("empty-zone"),a.html(n)):a.append(n)}),v())}})})}}),window.innerWidth<640&&($(".modal-step-content").css("minHeight",$(".export-books-modal").height()-86),$(".modal-step-content").css("minHeight",$("#remove-book-modal").height()-86),$(".modal-step-content.finish-remove").css("minHeight",$("#remove-book-modal").height()-130)),$(document).on("click","#remove-btn",function(){var e=$(this).data("isbn"),t=$(".tabs-nav  li.active a").data("id");localStorage.setItem("selectedIsbn",e),localStorage.setItem("reading-list-id",t),localStorage.setItem("title",$(this).attr("data-title")),l(),$("#remove-book-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")})}),$(document).on("click","#remove-book-reading-list",function(o){o.preventDefault();let s=$('input[name="remove-option"]:checked').val(),d=DOMPurify.sanitize(localStorage.getItem("selectedIsbn")),l=DOMPurify.sanitize(localStorage.getItem("reading-list-id"));var e=DOMPurify.sanitize(localStorage.getItem("title")),t=$(".loader-list-modale .loading-spinner");t.show(),$.ajax({url:"/reading-list-remove-book",method:"GET",data:{isbn:d,readingListID:l,option:s,bookTitle:e},success:function(i){if(!0===i.Result){o.preventDefault(),$('.tab-pane.active #book-item[data-isbn="'+d+'"]')[0].style.display="none",$('.tab-pane.active #book-item[data-isbn="'+d+'"]')[0].remove();let e=$("div").find("[data-isbn='"+d+"']").parent(),t=$("div").find("[data-id='"+l+"']").children().children().eq(1);var a,n;0===e.children().length&&(e.addClass("empty-zone"),a=DOMPurify.sanitize($(".append")),e.append(a),$(".append").css("display","block")),$("div").find("[title=''][data-isbn='"+d+"']").removeClass("isDisabled"),$("div").find("[title=''][data-isbn='"+d+"'] a").removeClass("isDisabled"),0===parseInt(s)?(n=t.text().match(/\d+/)[0],a=t.text().replace(/[0-9]+/,n-1),t.text(a),n-1==0&&((n=$(".tab-pane#"+l)).find(".list_reading_books.have-books").hide(),n.find("li.export-list .export-list-btn").parent().hide(),n.find(".add-section-bloc, .new-section-bloc, .NewSection").hide(),n.find(".list_reading_books.no-books, .moved-bloc").show())):1===parseInt(s)&&i.Data.forEach(e=>{var t=$("div").find("[data-id='"+e+"']").children().children().eq(1).text().match(/\d+/)[0],i=$("div").find("[data-id='"+e+"']").children().children().eq(1).text().replace(/[0-9]+/,t-1);$("div").find("[data-id='"+e+"']").children().children().eq(1).text(i),1===parseInt(t)&&($("div").find(".tab-pane#"+e).find(".list_reading_books.have-books").hide(),$("div").find(".tab-pane#"+e).find("li.export-list .export-list-btn").parent().hide(),$("div").find(".tab-pane#"+e).find(".add-section-bloc, .new-section-bloc, .NewSection").hide(),$("div").find(".tab-pane#"+e).find(".list_reading_books.no-books, .moved-bloc").show()),$.each($('.tab-pane #book-item[data-isbn="'+d+'"]'),function(e,t){$(this).css("display","none"),$(this).remove()}),$.each($(".have-books"),function(e,t){1===$(this).find(".new-section-bloc").length&&0===$(this).find(".book_item").length&&$(this).css("display","none")})}),$("#step1").removeClass("active"),$("#close-modal").hide(),$("#cancel-remove").hide(),$("#step2").addClass("active"),m()}t.hide()}}),c()}),$(document).on("click","#browse_btn",function(e){e.preventDefault(),$(".modal-step").removeClass("active"),$("#step3").addClass("active")}),$(document).on("click",".reading_list_modal #close-modal,#cancel-remove,#remove-book-reading-list-reason,#skip-btn",function(e){return e.preventDefault(),l(),modalFix(function(){$("body,html").removeClass("modal-open active-request scrollable"),$("#remove-book-modal").hide().removeClass("active")}),!1}),$("body").on("change",'input:radio[name="scales"]',function(){this.checked&&"other_reason"===this.id?$("#other_reason_block").css("display","block"):$("#other_reason_block").css("display","none")}),isMobile()&&($(".tabs-content").hide(),$(".see-menu-btn").hide(),$(".export-list.mobile").hide(),$(document).on("click",".tabs-nav a",function(e){$(".tabs-content").show(),$(".tabs-nav").hide(),$(".see-menu-btn").show(),$(".export-list.mobile").show(),$("html,body").animate({scrollTop:0},"slow")}),$(".see-menu-btn").click(function(){$(".tabs-nav").show(),$(".tabs-content").hide(),$(".see-menu-btn").hide(),$(".export-list.mobile").hide()})),isMobile()||$(".tabs-nav a").click(function(){window.scrollTo(0,0),$("html,body").animate({scrollTop:0},"slow")}),$('[data-toggle-pending="tooltip"]').tooltip({trigger:"hover"}),$(document).on("click","#more-btn",function(e){var t;e.preventDefault(),$(".more").removeClass("show-more-menu"),$(this).parent().find(".more-menu").is(":visible")?b($(this)):((t=$(this)).parent().addClass("show-more-menu"),t.attr("aria-hidden",!1),e.stopPropagation())}),$(document).on("click",function(){var e=$(".list_reading_books, .reading-info-container").find(".more-menu");$.each(e,function(e,t){$(t).is(":visible")&&b($(t))})}),isMobile()||$(".more-menu-item.for-mobile").remove(),$(document).on("click","#export-list",function(e){e.preventDefault();var e=$(this).data("reading-list-id"),t=[{".approved-container":"#"+e+" .book_item"}],i=$("#formExportBooks .loading-spinner");i.show(),localStorage.setItem("readingListId",e),setTimeout(function(){$.each(t,function(){$.each(this,function(e,t){$(t).each(function(e,t){var i=$(t).find(".imgBlock").attr("href").split("/"),a=i[i.length-1],i=uniqueID();$(".books-filtered").append(DOMPurify.sanitize('<li class="list-books"> <div class="small-12 medium-12 large-12  checkbox__item last-check-box undefined books-details"> <input id="'+i+'" type="checkbox" class="checkbox__input" data-isbn="'+a+'"> <label for="'+i+'" class="checlbox__label small-checkbox ">'+t.innerHTML+"</label></div></li>")),$(".books-filtered .list-books").each(function(){var e=DOMPurify.sanitize($(this).find(".imgBlock").html()),t=DOMPurify.sanitize($(this).find(".title-book").html()),i=DOMPurify.sanitize($(this).find(".author-name").html());$(this).find(".imgBlock").replaceWith('<span class="imgBlock">'+e+"</span>"),$(this).find(".title-book").replaceWith('<span class="title-book">'+t+"</span>"),$(this).find(".author-name").replaceWith('<div class="author-name">'+i+"</div>")}),$(".books-filtered .bookStatus").remove(),$(".books-filtered .ancillary-block").remove(),$(".books-filtered .sharing").remove(),$("input:checkbox").prop("checked",!0)})})}),$(".list-books :checkbox").change(function(){0===$(".list-books :checkbox:checked").length?($("#export-books").addClass("btnDisabled"),$("#select-all").trigger("click")):$("#export-books").removeClass("btnDisabled")}),$("#select-all").change(function(){0===$(".list-books :checkbox:checked").length?$("#export-books").addClass("btnDisabled"):$("#export-books").removeClass("btnDisabled")}),i.hide()}),$(".export-books-modal").show().addClass("active"),$("#select-deselect").text($("#select-all").data("deselect-all")),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")}),$("#export-books").text($("#continue-btn").text()),$(".export-books-modal .close").show()}),$(".export-books-modal .close").on("click",function(){$("#export-books").removeClass("loading"),p()}),$("#select-all").on("click",function(){$("#select-all").is(":checked")?($("input:checkbox").prop("checked",!0),$("#select-deselect").text($(this).data("deselect-all"))):($("input:checkbox").prop("checked",!1),$("#select-deselect").text($(this).data("select-all")))}),$("#export-books").on("click",function(e){if(e.preventDefault(),$(this).hasClass("btnDisabled"))return!1;var t,i=[],e=new Date,a=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear(),n=$(".box"),e=$("input[type=checkbox]:checked"),o=$("#export-books"),s=$("#book-list-export").text();0===e.length?(t=$(this).data("error-text"),n.find(".error-msg").text(t),n.attr("class","box active error-info"),n.on("click","#box-ok",function(){n.removeClass("active error-info"),n.off("click")})):(o.addClass("loading"),t=DOMPurify.sanitize(localStorage.getItem("readingListId")),e.each(function(){var e=$(this).data("isbn");i.push({isbn:e})}),$.ajax({url:$("#export-list").data("url"),method:"POST",data:{books:i,readingListId:t},success:function(e){var t=DOMPurify.sanitize(JSON.stringify(e)),e=JSON.parse(t).file,t=$("<a>");/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)&&(t.attr("href","data:application/vnd.ms-word;base64,"+e),$("body").append(t),t.attr("download",s+" ("+a+").docx"),t[0].click(),t.remove(),o.removeClass("loading"),closeModal($(".export-books-modal")),$(".export-books-modal .close").on("click"),p())},error:function(){document.location.reload()}}))}),v();var C=1,D=$("#readingListName").attr("data-default-text");function w(){$(".new_reading_list_modal .modal-step").removeClass("active"),$("#formAddReadingList #step1").addClass("active"),$("#formAddReadingList #courseName").val(""),$("#formAddReadingList #courseType").val(""),$("#formAddReadingList #courseLevel").val("").trigger("change"),$("#formAddReadingList #studentsNumber").val(""),$("#formAddReadingList #startDate").datepicker("setDate",null),$("#formAddReadingList #institutions-selector option.my-primary").prop("selected",!0).trigger("change"),$(".modal-step .error").remove(),$(".modal-step .warning").removeClass("warning")}$(document).on("click",".btn-add-reading-list",function(){w(),$(".new_reading_list_modal").show().addClass("active"),C=function(){0<$(".book-name").length&&$.each($(".book-name"),function(e,t){var i=$(this).text().split(" "),a=i[i.length-1];parseInt(a)&&C<=parseInt(a)&&(i.pop(),$.trim(i.join(" "))===D&&(C=parseInt(a)+1))});return C}(),$("#formAddReadingList #readingListName").val(D+" "+C),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")}),$(".new_reading_list_modal .close").show()}),$(document).on("click",".new_reading_list_modal #close-modal",function(e){e.preventDefault(),o.find("#box-confirm").text($("#box-msg-yes").text()),o.find("#box-cancel").text($("#box-msg-no").text());var t=$(".new_reading_list_modal");"step3"===t.find(".modal-step.active").attr("id")?(closeModal(t),w()):(o.attr("class","box active confirm-info"),o.find(".confirm-msg").text($("#cancel-list-msg").text()),$("body").addClass("box-above-modal"),o.on("click","#box-cancel",function(){o.removeClass("active confirm-info"),o.off("click"),$("body").removeClass("box-above-modal")}).on("click","#box-confirm",function(){o.removeClass("active confirm-info"),closeModal(t),o.off("click"),$("body").removeClass("box-above-modal"),w(),window.scrollTo(0,0),$("html,body").animate({scrollTop:0},"slow")}))}),$(document).on("click",".new_reading_list_modal .goStep:not(.loading)",function(e){e.preventDefault();var b,t=$(this).data("target-step");n.readingListName=$("#formAddReadingList #readingListName").val(),$("#formAddReadingList .error").remove(),$("a.more-menu-btn.isDisabled").removeClass("isDisabled"),0<n.readingListName.length?(n.readingListName=$("#formAddReadingList #readingListName").val(),e=n,b=new Date,function(n,o){var s=$("#submit-request-btn");s.addClass("loading"),$.ajax({url:$("#formAddReadingList").data("url"),method:"POST",data:n,success:function(e){s.removeClass("loading");let t=$("div").find("[title='copybtn']"),i=$("div").find("[title='movebtn']");for(var a=0;a<t.length;a++)t[a].id="copy-book-btn",i[a].id="move-book-btn",t[a].children[0].classList.remove("isDisabled"),i[a].children[0].classList.remove("isDisabled");o(e.success,n,e),initPopover(),closePopover()},error:function(e){s.removeClass("loading"),401===e.status&&document.location.reload()}})}(e,function(e,t,i){var a,n,o=$("#tooltip-more").val(),s=$("#no-books-reading-list").text(),d=$(".see-history-text").text(),l=$("#remove-list").text(),c=$("#export-list").text(),r=$("#export-url").text(),m=$(".edit_list").text();e&&(a=$(".tabs-nav ul"),n=$("#reading-list-content"),$("#formAddReadingList #step2").removeClass("active"),$("#formAddReadingList #step3").addClass("active"),e=b.getDate()+" "+b.toLocaleString("en-us",{month:"short"})+" "+b.getFullYear()+", "+b.toLocaleString("en-US",{hour:"numeric",minute:"numeric",hour12:!0}),a.find("li").removeClass("active"),a.append(DOMPurify.sanitize('<li class="active">                                <a href="#'+i.id+'" data-toggle="tab" data-id='+i.id+'>                                    <div class="book-info">                                        <div class="book-name"> '+t.readingListName+'</div>                                        <div class="nbr-books" data-id="">0 '+$("#books-tab").text()+"</div>                                    </div>                                </a>                            </li>")),0===n.length&&($(".reading-list-container").append(DOMPurify.sanitize(' <div class="reading-list tabs-content" id="reading-list-content">')),n=$("#reading-list-content")),n.find(".tab-pane").removeClass("active"),n.append(DOMPurify.sanitize('<div class="tab-pane active" id="'+i.id+'" \n<div id="tab1" class="tabs_container">\n        <div class="reading-info nexusSans">\n        <div class="reading-info-container row">\n           <div class="reading-list-name small-12 medium-6 large-6 columns pr-0">\n                        <div class="">\n                                 <input type="text" class="input-list-name input-section-name readonly" value="'+t.readingListName+'" readonly maxlength="50">\n                        </div>\n                        <div class="update-actions hidden"><span class="save-update"><div class="check"></div></span><span class="cancel-update">\n                                    <div class="close_section"></div>\n                                </span>\n                        </div>\n                    </div>\n<div class="right_block small-12 large-6 medium-6 pr-0 pl-0 columns">\n<div class="small-12 medium-2 large-2 columns sharing_menu"><div class="sharing sharing_header">\n                                <div class="container">\n                                    <div class="more">\n                                        <button id="more-btn" class="more-btn" data-toggle="tooltip" data-placement="bottom"\n                                                title="'+o+'">\n                                            <span class="more-dot"></span>\n                                            <span class="more-dot"></span>\n                                            <span class="more-dot"></span>\n                                        </button>\n                                        <div class="more-menu">\n                                            <ul class="more-menu-items" tabindex="-1" role="menu"\n                                                aria-labelledby="more-btn" aria-hidden="true">\n                                           <li class="more-menu-item export-list"  style="display: none" >\n                                                        <a class="btn-blue export-list-btn" id="export-list"\n                                                           data-url="'+r+'"\n                                                           data-reading-list-id="'+i.id+'">'+c+'</a>\n                                                    </li>\n                                                   <li class="more-menu-item edit-list-name-item" id="edit-list" > <div>\n                                                        <a href="javascript:;" class="more-menu-btn edit-list-name"\n                                                            role="presentation">'+m+'</a></div>\n                                                    </li>\n                                                <li class="more-menu-item export-list"\n                                                    role="">\n                                                    <div class="read-now-btn" id="remove-list-btn"\n                                                         data-reading-list-id="'+i.id+'">\n                                                        <a href="javascript:;"\n                                                           class="more-menu-btn"\n                                                           role="menuitem">'+l+'</a>\n                                                    </div>\n                                                </li>\n                                            </ul>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div></div>\n <div class="date_container"><div class="date"> Last updated  '+e+'</div> <div class="link-history"> <a href="javascript:;" class="see-history" data-list-id="'+i.id+'" data-list-name="'+t.readingListName+'">'+d+"</a> </div> </div></div></div></div></div></div>")),1===$(".tabs-nav li").length&&$(".reading-list-container .list_reading_books").hide(),r=$(".edit-section-name img").attr("src"),c=$(".initial-section-name").text(),m=DOMPurify.sanitize($(".delete-section-btn img").attr("src")),l=$(".edit-section-name img").attr("data-original-title"),e=$(".delete-section-btn img").attr("data-original-title"),t=$(".add-section-text").text(),d=DOMPurify.sanitize($(".no-section").html()),i=sanitizeHTML(i.id),s='<div class="list_reading_books have-books" style="display: none"><a href="javascript:;" class="delete-section-btn"> <img src="'+m+'" srcset="'+baseUrl+"/assets/img/icon-delete/icon_delete@2x.png?v=2.5.3 2x,"+baseUrl+'/assets/img/icon-delete/icon_delete@3x.png?v=2.5.3 3x" class="icon_edit" title="'+e+'" data-original-title="'+e+'" data-toggle="tooltip" data-placement="bottom"></a><div class="book_type text-center section_name"> <div class="new-section-bloc"> <input type="text" class="input-section-name readonly" style="width:auto" value="'+c+'" readonly maxlength="65"> <a href="javascript:;" class="edit-section-name"> <img src="'+r+'" srcset="'+baseUrl+"/assets/img/icon-edit/icon_edit@2x.jpg?v=2.5.3 2x,"+baseUrl+'/assets/img/icon-edit/icon_edit@3x.jpg?v=2.5.3 3x" class="icon_edit" title="'+l+'" data-original-title="'+l+'" data-toggle="tooltip" data-placement="bottom"></a> </div> <div class="update-actions hidden"><span class="save-update"><div class="check"></div></span><span class="cancel-update"> <div class="close_section"></div> </span> </div> </div><div class="books_list"><div class="drop-zone empty-zone" data-title="'+i+'"><div class="drag-placeholder nexusSans" id="placeholder_drag">'+d+'</div></div></div></div><div class="text-center mt-24 add-section-bloc" style="display: none;">\n                    <span class="add-new-section" style="cursor: pointer">'+t+'</span>\n                </div><div class="list_reading_books no-books" id="'+i+'">\n                    <div class="text-center no-list-books nexusSans">\n                        <div class="empty_book-img" id="'+i+'" >\n                            <img class="retina-reload" src="'+baseUrl+'/assets/img/empty_book/book_empty@1x.png"\n                                 style="height: 152px;width: 152px;">\n                        </div>\n                        <div class="empty_book-msg">\n                           <p>\n'+s+"                           </p>\n                        </div>\n                    </div>\n                </div>",s=DOMPurify.sanitize(s),$(".tab-pane.active").append(s),z($("#reading-list-content .input-section-name"))),"scrollRestoration"in history&&(history.scrollRestoration="manual"),isMobile()&&setTimeout(function(){$("li.active a").trigger("click")}),window.scrollTo(0,0),$("html,body").animate({scrollTop:0},"slow")}),c(),$(this).closest(".modal-step").removeClass("active"),$("#formAddReadingList #"+t).addClass("active")):(t=sanitizeHTML($("#formAddReadingList #readingListName").prop("title")),t=DOMPurify.sanitize('<span class="error">'+t+"</span>"),$("#formAddReadingList #readingListName").addClass("warning").parent().append(t)),c()}),$(document).on("click",".delete-section-btn",function(){i=!0;var e=$(".box");e.find("#box-confirm").text($("#btn-confirm").text()),e.find("#box-cancel").text($("#cancel-btn").text()),e.attr("class","box active confirm-info"),e.find(".confirm-msg").text($(".remove-section-alert").text()),e.find("#box-cancel").css("display","");var t=$(this);e.on("click","#box-confirm",function(){e.removeClass("active error-info"),e.off("click");var a=$(".tab-pane.active").attr("id");0<t.closest(".list_reading_books").find(".book_item").length&&($.each(t.closest(".list_reading_books").find(".book_item"),function(e,t){var i={};i.isbn=DOMPurify.sanitize($(this).attr("data-isbn")),i.title=$(this).find(".prodTitle").data("book-title"),r(i,a)}),$("a.more-menu-btn.isDisabled").removeClass("isDisabled")),t.closest(".list_reading_books").remove(),t.parent().remove(),0==$("#reading-list-content .tab-pane.active input").length&&($("#reading-list-content .tab-pane.active .no-books").show(),$("#reading-list-content .tab-pane.active .add-new-section").hide())}),e.on("click","#box-cancel",function(){e.removeClass("active error-info"),e.off("click")})}),isMobile()&&($('[data-toggle="tooltip"]').on("touchstart",function(){$(this).closest(".book_item.draggable").attr("draggable","")}),$(".book_item.draggable").on("click",function(){$(".book_item.draggable").attr("draggable","true"),$('[data-toggle="tooltip"]').tooltip("hide")}),$(".student_ressources,.instrutor_ressources").on("click",function(e){e.stopPropagation()}));var L="",I="";function z(e){$.each(e,function(e,t){this.style.width=this.value.length+"ch"})}$(document).on("click",".edit-section-name",function(e){!0===i?i=!1:($(this).parent().find(".input-section-name").hasClass("readonly")?($(this).parent().find(".input-section-name").removeAttr("readonly"),$(this).parent().find(".input-section-name").removeClass("readonly"),$(this).addClass("hidden"),$(this).parent().parent().find(".update-actions").removeClass("hidden"),$(this).parent().parent().find(".book_type.section_name").addClass("edited")):($(this).parent().find(".input-section-name").attr("readonly","readonly"),$(this).parent().find(".input-section-name").addClass("readonly"),$(this).removeClass("hidden"),$(this).parent().parent().find(".update-actions").addClass("hidden"),$(this).parent().parent().find(".book_type.section_name").removeClass("edited")),L=$(this).parent().find(".input-section-name").val())}),$(document).on("click",".section_name .save-update",function(e){$(this).parent().parent().find(".input-section-name").attr("readonly","readonly"),$(this).parent().parent().find(".input-section-name").addClass("readonly"),$(this).parent().parent().find(".edit-section-name").removeClass("hidden"),$(this).parents().eq(5).find(".book_type.section_name").removeClass("edited"),$(this).parent().parent().find(".update-actions").addClass("hidden");var n=$(this).parent().parent().find(".input-section-name").val();$(this).parent().parent().parent().find(".drop-zone").attr("data-section-name",n),$.each($(this).parents().eq(5).find(".book_item"),function(e,t){var i=DOMPurify.sanitize($(this).attr("data-isbn")),a=$(this).attr("data-reading-list-id");$.ajax({url:"/reading-list-book-category-update",method:"put",data:{readingListID:a,isbn:i,category:n},success:function(e){}})}),z($("#reading-list-content .input-section-name"))}),$(document).on("click",".section_name .cancel-update",function(e){var t=$(this).parent().parent();t.find(".input-section-name").attr("readonly","readonly"),t.find(".input-section-name").addClass("readonly"),t.find(".edit-section-name").removeClass("hidden"),t.find(".update-actions").addClass("hidden"),$(this).parents().eq(5).find(".book_type.section_name").removeClass("edited"),t.find(".input-section-name").val(L),z($("#reading-list-content .input-section-name"))}),$(document).on("click",".add-new-section",function(){var e=DOMPurify.sanitize($(".default-section-name").text()),t=DOMPurify.sanitize($(".no-section").html()),i=DOMPurify.sanitize($(".delete-section-btn img").attr("src")),a=e,n=DOMPurify.sanitize($("#tooltip-edit").text()),o=DOMPurify.sanitize($("#tooltip-more").text()),s=DOMPurify.sanitize($("#tooltip-remove").text()),d=DOMPurify.sanitize($(".delete-section-btn img").attr("data-original-title")),t=' <div class="list_reading_books"><a href="javascript:;" class="delete-section-btn"> <img src="'+i+'" srcset="'+baseUrl+"/assets/img/icon-delete/icon_delete@2x.png?v=2.5.3 2x,"+baseUrl+'/assets/img/icon-delete/icon_delete@3x.png?v=2.5.3 3x"class="icon_edit" title="'+d+'" data-original-title="'+d+'" data-toggle="tooltip" data-placement="bottom"></a> <div class="book_type new-section text-center section_name '+a+'"> <div class="new-section-bloc"><div class="input-container"><input type="text" class="input-section-name readonly" value="'+e+'" readonly maxlength="65"><div class="update-actions hidden"><span class="save-update"><div class="check"></div></span><span class="cancel-update"><div class="close_section"></div></span></div></div>  <div class="sharing edit-section-name">\n                                        <div class="container">\n                                            <div class="more">\n                                                <button id="more-btn" class="more-btn" data-toggle="tooltip" data-placement="bottom"\n                                                        title="'+o+'">\n                                                    <span class="more-dot"></span>\n                                                    <span class="more-dot"></span>\n                                                    <span class="more-dot"></span>\n                                                </button>\n                                                <div class="more-menu">\n                                                    <ul class="more-menu-items" tabindex="-1" role="menu"\n                                                        aria-labelledby="more-btn" aria-hidden="true">\n                                                        <li class="more-menu-item"\n                                                            role="presentation">\n                                                            <div>\n                                                                <a href="javascript:;" class="more-menu-btn edit-section-name"\n                                                                   role="menuitem">'+n+'</a>\n                                                            </div>\n                                                        </li>\n                                                        <li class="more-menu-item"\n                                                            role="presentation">\n                                                            <div>\n                                                                <a href="javascript:;" class="more-menu-btn delete-section-btn" role="menuitem">'+s+'</a>\n                                                            </div>\n                                                        </li>\n                                                    </ul>\n                                                </div>\n                                            </div>\n                                        </div>\n                                    </div></div> <div class="books_list"> <div class="drop-zone empty-zone" id="'+a+'" data-section-name="'+a+'"> <div class="drag-placeholder nexusSans" id="placeholder_drag">'+t+"</div> </div></div> </div>";$(this).before(DOMPurify.sanitize(t)),m(),v(),z($("#reading-list-content .input-section-name")),$('[data-toggle="tooltip"]').tooltip(),initPopover(),closePopover()}),$(document).on("click",".see-history",function(e){var t=$(this).data("list-id"),i=$(this).data("list-name");$(".history-modal").remove(),$.ajax({url:"/get-list-history",method:"post",data:{readingListId:t,ListName:i},dataType:"html",success:function(e){0===e.length||2===e.length?document.location.reload():(e=DOMPurify.sanitize(e),$(".reading-list-page").append(e),$("#history-modal-"+t).modal("show"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")}),$(".modal-backdrop").css("display","none"))}})}),$(document).on("click","#edit-list",function(e){$(this).parents().eq(8).find(".input-list-name").hasClass("readonly")?($(this).parents().eq(8).find(".input-list-name").removeAttr("readonly"),$(this).parents().eq(8).find(".input-list-name").removeClass("readonly"),$(this).parents().eq(8).find(".update-actions").removeClass("hidden")):($(this).parents().eq(8).find(".input-list-name").attr("readonly","readonly"),$(this).parents().eq(8).find(".input-list-name").addClass("readonly"),$(this).parents().eq(8).find(".update-actions").addClass("hidden")),I=$(this).parents().eq(8).find(".input-list-name").val()}),$(document).on("click",".reading-list-name .save-update",function(e){var t=$(this).parent().parent();t.find(".input-list-name").attr("readonly","readonly"),t.find(".input-list-name").addClass("readonly"),t.find(".edit-list-name").removeClass("hidden"),t.find(".update-actions").addClass("hidden");var i,a=$.trim(t.find(".input-list-name").val());""!=a?(i=$(".tab-pane.active").attr("id"),$.ajax({url:"/list-name-update",method:"put",data:{readingListID:i,listName:a},success:function(e){$("li.active").find(".book-name").text(a)}}),z($(".reading-info-container .input-list-name"))):t.find(".input-list-name").val($("li.active").find(".book-name").text())}),$(document).on("click",".reading-list-name .cancel-update",function(e){var t=$(this).parent().parent();t.find(".input-list-name").attr("readonly","readonly").addClass("readonly"),t.find(".update-actions").addClass("hidden"),t.find(".input-list-name").val(I),z($(".reading-info-container .input-list-name"))}),$(document).on("click",".review-book",function(){var e=$(this).attr("data-title"),t=$(this).attr("data-subtitle"),i=DOMPurify.sanitize($(this).attr("data-isbn")),a=$(this).attr("data-editionNumber");i&&($("#rating-book-modal .book_title").text(e),$("#rating-book-modal .book_subtitle").text(t),a&&$("#rating-book-modal .edition_num").text($("#rating-book-modal .edition_num").attr("data-text-edition")+" "+a),$("#rating-book-modal .popup-title").attr("data-book_isbn",i),i=$("#"+i).find("img").attr("src"),$("#rating-book-modal .cover").attr("src",i))})}),$(document).on("click",".dot-share-product-popup",function(e){e.preventDefault(),copyToClipboard($(this).find("a").attr("data-link"),"#share-book-modal")});