function resetReviewModal(){$(".review-rating-book-modal .modal-step.active").removeClass("active"),$(".review-rating-book-modal .error").remove(),$("review-rating-book-modal .warning").removeClass("warning"),$("#feedback-step .review-container .star").removeClass("active"),$("#feedback_public, #feedback_name_public").attr("checked",!1),$("#feedBack").val(""),$(".modal-backdrop")[0]&&$(".modal-backdrop").remove()}function currentStepValid(){var i=!0,e=$(".modal-step.active .validate:visible"),a=$("#feedback_name_public");return e.removeClass("warning"),$(".modal-step.active").find(".error").remove(),$.each(e,function(e,a){var t;$(a).val()||(t=DOMPurify.sanitize($(a).prop("title")),$(a).addClass("warning").parent().append('<span class="error">'+t+"</span>"),i=!1)}),a.removeClass("warning"),a.find(".error").remove(),0===$("#feedback_name_public:checked").length&&(a.addClass("warning"),i=!1),i}$(document).ready(function(){$(".review-rating-book-modal .star").on("click",function(e){e.preventDefault();var e=$(".review-rating-book-modal .review-container .star"),a=e.index($(this));$(this).hasClass("active")&&a==$(".review-rating-book-modal .star.active").length-1?$(this).removeClass("active"):e.each(function(e){e<=a?$(this).addClass("active"):$(this).removeClass("active")})}),$(document).on("click",".review-book",function(){resetReviewModal(),$("#feedback-step").addClass("active feedback-modal"),$(".review-rating-book-modal").show().addClass("active"),modalFix(function(){$("body,html").addClass("modal-open active-request scrollable")}),$(".review-rating-book-modal .close").show()}),$(document).on("click",".submit-book-review",function(e){e.preventDefault();var a,t,i=$(this);currentStepValid()&&(a={},0<(e=$("#feedBack").val()).length&&(a.feedback={message:e,public:$("#feedback_public").is(":checked")?1:0,name_public:$("#feedback_name_public").is(":checked")?1:0,rating:$(".review-rating-book-modal .star.active").length,isbn:$("#feedback-step .popup_header").data("book_isbn")}),a=a,t=i,$.ajax({url:t.closest("form").data("url"),method:"POST",data:a,dataType:"JSON",beforeSend:function(){t.addClass("loading")},success:function(e){e.success&&($(".modal-step.active").removeClass("active"),$("#finish-step").addClass("active"),t.removeClass("loading"),urlrate=$(".path_for_ajax").attr("url-data"),urlaverage=$(".path_for_ajax_average").attr("url-data"),$.get(urlrate,function(e){e=DOMPurify.sanitize(e);$(".content_review_rating_comments").html(e)}),$.get(urlaverage,function(e){e=DOMPurify.sanitize(e);$(".average_reviews").html(e)}))},error:function(e){t.removeClass("loading"),401===e.status?showErrorBox($("#logout-feedback-msg").text()):showErrorBox($("#error").text())}}))}),window.innerWidth<640&&$(document).on("click","#feedback_public",function(e){$("#feedback_public").is(":checked")?$(".public-info").show():$(".public-info").hide()}),$(document).on("keypress",".validate",function(e){if(13===e.keyCode)return e.preventDefault(),!1})});